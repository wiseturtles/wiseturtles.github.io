<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Wise Turtles</title><link href="http://blog.wiseturtles.com/" rel="alternate"></link><link href="http://blog.wiseturtles.com/feeds/configuration.atom.xml" rel="self"></link><id>http://blog.wiseturtles.com/</id><updated>2016-08-24T18:20:00+08:00</updated><entry><title>git从历史中删除大文件</title><link href="http://blog.wiseturtles.com/posts/git-remove-large-files-in-history.html" rel="alternate"></link><published>2016-08-24T18:20:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-08-24:posts/git-remove-large-files-in-history.html</id><summary type="html">&lt;p&gt;如果有人在git库中提交了超大文件导致所有人下载代码都比较耗时怎么办？&lt;/p&gt;
&lt;h2&gt;删除git库中的大文件&lt;/h2&gt;
&lt;p&gt;我们知道git会保留历史记录，即使删除这些大文件并提交也无法减少git库的体积。&lt;/p&gt;
&lt;p&gt;可以用 &lt;code&gt;git filter-branch&lt;/code&gt; 解决，比如：删除误提交的 &lt;code&gt;src/node_modules&lt;/code&gt; 目录。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ git filter-branch --tree-filter &lt;span class="s1"&gt;&amp;#39;rm -rf src/node_modules&amp;#39;&lt;/span&gt; --prune-empty
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;找出git库中体积最大的文件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ git rev-list master &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;read&lt;/span&gt; rev&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; git ls-tree -lr &lt;span class="nv"&gt;$rev&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; cut -c54- &lt;span class="p"&gt;|&lt;/span&gt; grep -v &lt;span class="s1"&gt;&amp;#39;^ &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -u &lt;span class="p"&gt;|&lt;/span&gt; perl -e &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;    while (&amp;lt;&amp;gt;) {&lt;/span&gt;
&lt;span class="s1"&gt;        chomp;&lt;/span&gt;
&lt;span class="s1"&gt;        @stuff=split(&amp;quot;\t&amp;quot;);&lt;/span&gt;
&lt;span class="s1"&gt;        $sums{$stuff[1]} += $stuff[0];&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;    print &amp;quot;$sums{$_} $_\n&amp;quot; for (keys %sums);&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -rn
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注：
1. 这段代码来自 - http://blog.jessitron.com/2013/08/finding-and-removing-large-files-in-git.html
2. 还有个类似的工具有兴趣可以尝试 - &lt;a href="https://rtyley.github.io/bfg-repo-cleaner/"&gt;&lt;span class="caps"&gt;BFG&lt;/span&gt;&amp;nbsp;Repo-Cleaner&lt;/a&gt;&lt;/p&gt;</summary><category term="Git"></category></entry><entry><title>SaltStack介绍</title><link href="http://blog.wiseturtles.com/posts/get-started-saltstack.html" rel="alternate"></link><published>2016-08-10T20:40:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-08-10:posts/get-started-saltstack.html</id><summary type="html">&lt;p&gt;本文只介绍了SaltStack在CentOS上的安装，其它其它有类似的包管理工具可以安装.&lt;/p&gt;
&lt;h2&gt;CentOS上安装salt-master和salt-minion&lt;/h2&gt;
&lt;h3&gt;安装salt-master&lt;/h3&gt;
&lt;p&gt;在centos上安装salt-master:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;rpm&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;x86_64&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SALTSTACK&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;bash&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cat - &amp;gt; /etc/yum.repos.d/saltstack.repo &amp;lt;&amp;lt;&amp;quot;EOF&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SaltStack&lt;/span&gt; &lt;span class="n"&gt;repo&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;RHEL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CentOS&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;
&lt;span class="n"&gt;baseurl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;basearch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;
&lt;span class="n"&gt;enabled&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;gpgcheck&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;gpgkey&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;basearch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SALTSTACK&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;
&lt;span class="n"&gt;EOF&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;clean&lt;/span&gt; &lt;span class="n"&gt;expire&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;master&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;enable&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;master&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;master&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;安装salt-minion&lt;/h3&gt;
&lt;p&gt;在centos上安装salt-minion:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;rpm&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;x86_64&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SALTSTACK&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;bash&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cat - &amp;gt; /etc/yum.repos.d/saltstack.repo &amp;lt;&amp;lt;&amp;quot;EOF&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SaltStack&lt;/span&gt; &lt;span class="n"&gt;repo&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;RHEL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CentOS&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;
&lt;span class="n"&gt;baseurl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;basearch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;
&lt;span class="n"&gt;enabled&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;gpgcheck&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;gpgkey&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;saltstack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;redhat&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;releasever&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;basearch&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;latest&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SALTSTACK&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;
&lt;span class="n"&gt;EOF&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;clean&lt;/span&gt; &lt;span class="n"&gt;expire&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;minion&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;bash&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;echo &amp;#39;master: $SALT_MASTER&amp;#39; &amp;gt;&amp;gt; /etc/salt/minion&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# $SALT_MASTER 替换为salt master主机的IP&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;enable&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;minion&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;minion&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注: 如果salt-master使用默认配置，请确保salt-master的4505,&amp;nbsp;4506端口可以被salt-minion访问.&lt;/p&gt;
&lt;h3&gt;简单测试&lt;/h3&gt;
&lt;p&gt;salt-minion设置过master &lt;span class="caps"&gt;IP&lt;/span&gt;并重启salt-minion后，应该在salt-master上可以通过下面命令看到minion:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt-key -L  # 列出所有minion
[root@master ~]$ salt-key -A  # 接受所有minion，也可以通过 -a 接受指定minion
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接受minion后，就可以在salt-master上发布命令到minion了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;root&lt;span class="o"&gt;@&lt;/span&gt;master &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt; salt &lt;span class="s"&gt;&amp;#39;*&amp;#39;&lt;/span&gt; test.ping  &lt;span class="c1"&gt;# 简单测试master &amp;lt;-&amp;gt; minion是否连通&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;选择主机&lt;/h2&gt;
&lt;p&gt;经常会看到 &lt;code&gt;salt '*' test.ping&lt;/code&gt; 这里的 &lt;code&gt;'*'&lt;/code&gt; 意思是作用于所有主机。&lt;/p&gt;
&lt;p&gt;下面介绍 salt&amp;nbsp;支持的匹配方式。&lt;/p&gt;
&lt;h3&gt;globbing&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt &amp;#39;ubuntu*&amp;#39; disk.usage
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;grains&amp;nbsp;system&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt -G &amp;#39;os:CentOS&amp;#39; cmd.run &amp;#39;id&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;regular&amp;nbsp;expression&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt -E &amp;#39;centos[0-9]&amp;#39; test.ping
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;明确指定一个列表&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt -L &amp;#39;centos1,centos2&amp;#39; test.ping
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;multiple target types can be combined in one&amp;nbsp;command&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="n"&gt;master&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;salt&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;G&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="nl"&gt;os&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;CentOS&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;centos&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;or&lt;/span&gt; &lt;span class="n"&gt;S&lt;/span&gt;&lt;span class="mf"&gt;@192.168.50&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ping&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注: 参考 - &lt;a href="https://docs.saltstack.com/en/getstarted/fundamentals/targeting.html"&gt;https://docs.saltstack.com/en/getstarted/fundamentals/targeting.html&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;执行命令&lt;/h2&gt;
&lt;h3&gt;执行单个命令，比如：在minion上执行&lt;code&gt;id&lt;/code&gt;命令并输出:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt &amp;#39;*&amp;#39; cmd.run &amp;#39;id&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;执行脚本：&lt;/h3&gt;
&lt;p&gt;首先要开启&lt;code&gt;/etc/salt/master&lt;/code&gt;的如下设置:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;file_roots&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="sr"&gt;/srv/s&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果salt-master没有&lt;code&gt;/srv/salt/scripts&lt;/code&gt;目录请自己创建，然后写个简单脚本:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ cat /srv/salt/scripts/get_ip.sh
#!/bin/bash

ifconfig | grep &amp;#39;inet &amp;#39; | grep -Ev &amp;#39;127.0.0.1&amp;#39; | awk &amp;#39;{print $2}&amp;#39;

[root@master ~]$ salt &amp;#39;*&amp;#39; cmd.script &amp;#39;salt://scripts/get_ip.sh&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Tips&lt;/h2&gt;
&lt;h3&gt;以指定用户运行salt-master，避免每次输入salt指令都需要加&amp;nbsp;sudo；比如以centos用户运行salt-master&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[centos@master ~]$ sudo chown -R centos /etc/salt /var/log/salt /var/cache/salt /var/run/salt
[centos@master ~]$ sudo mkdir -p /srv/salt
[centos@master ~]$ sudo chown -R centos /srv/salt
在 /etc/salt/master 中设置 user: centos
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注: 理论上salt-minion也可以通过这种方式运行以指定用户运行，但我测试会报错 &amp;#8220;Minion did not return. [No&amp;nbsp;response]&amp;#8221;&lt;/p&gt;
&lt;h3&gt;删除无法连接的salt&amp;nbsp;minion&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@master ~]$ salt-run manage.down removekeys=True
&lt;/pre&gt;&lt;/div&gt;</summary><category term="CentOS"></category><category term="SaltStack"></category></entry><entry><title>Too many files open</title><link href="http://blog.wiseturtles.com/posts/Too-many-files-open.html" rel="alternate"></link><published>2016-07-27T18:06:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-07-27:posts/Too-many-files-open.html</id><summary type="html">&lt;h2&gt;Linux&lt;/h2&gt;
&lt;p&gt;将下面的行加入 &lt;code&gt;/etc/security/limits.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;*               soft    nofile             8192
*               hard    nofile             8192
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;将下面的行加入 &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; ，提高kernel性能，可以不添加。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.ip_local_port_range = 1024 65000
fs.file-max = 65000
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运行 &lt;code&gt;sudo sysctl -p&lt;/code&gt; 将对 &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; 的修改生效。&lt;/p&gt;
&lt;h2&gt;Mac&lt;/h2&gt;
&lt;p&gt;查看max&amp;nbsp;files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo launchctl limit
    cpu         unlimited      unlimited
    filesize    unlimited      unlimited
    data        unlimited      unlimited
    stack       &lt;span class="m"&gt;8388608&lt;/span&gt;        67104768
    core        &lt;span class="m"&gt;0&lt;/span&gt;              unlimited
    rss         unlimited      unlimited
    memlock     unlimited      unlimited
    maxproc     &lt;span class="m"&gt;709&lt;/span&gt;            1064
    maxfiles    &lt;span class="m"&gt;256&lt;/span&gt;            unlimited
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改max&amp;nbsp;file到8192:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo launchctl limit maxfiles &lt;span class="m"&gt;8192&lt;/span&gt; unlimited
$ sudo launchctl limit
    cpu         unlimited      unlimited
    filesize    unlimited      unlimited
    data        unlimited      unlimited
    stack       &lt;span class="m"&gt;8388608&lt;/span&gt;        67104768
    core        &lt;span class="m"&gt;0&lt;/span&gt;              unlimited
    rss         unlimited      unlimited
    memlock     unlimited      unlimited
    maxproc     &lt;span class="m"&gt;709&lt;/span&gt;            1064
    maxfiles    &lt;span class="m"&gt;8192&lt;/span&gt;           10240

&lt;span class="c1"&gt;# 注：&lt;/span&gt;
$ sudo launchctl limit maxfiles unlimited  &lt;span class="c1"&gt;# 也可以直接设置为unlimited&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Mac"></category><category term="Linux"></category></entry><entry><title>Ubuntu/Debian自动安装安全更新</title><link href="http://blog.wiseturtles.com/posts/ubuntu-debian-automatic-security-updates.html" rel="alternate"></link><published>2016-05-06T12:38:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-05-06:posts/ubuntu-debian-automatic-security-updates.html</id><summary type="html">&lt;p&gt;有台Ubuntu机器，仅仅为了科学上网，但，这年头漏洞这么多，万一哪天成肉鸡了呢。。。&lt;/p&gt;
&lt;p&gt;本文简单记录下Ubuntu系统配置自己安装系统安全补丁。(Debian系统应该也适用)&lt;/p&gt;
&lt;h2&gt;安装unattended-upgrades自动更新安全补丁&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install unattended-upgrades
$ sudo dpkg-reconfigure unattended-upgrades  &lt;span class="c1"&gt;# 选Yes，自动下载安装&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据自己情况修改配置文件 - &lt;code&gt;/etc/apt/apt.conf.d/50unattended-upgrades&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;可以设置邮件通知。&lt;/p&gt;
&lt;h2&gt;如果只想收到邮件通知，可以安装apticron&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ apt-get install apticron
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改配置文件 - &lt;code&gt;/etc/apticron/apticron.conf&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;订阅相关邮件列表，了解最新安全信息&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;[Ubuntu Security Notices]&lt;a href="http://www.ubuntu.com/usn/"&gt;http://www.ubuntu.com/usn/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[Debian Security Information]&lt;a href="https://www.debian.org/security/index.en.html"&gt;https://www.debian.org/security/index.en.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参考链接:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/AutomaticSecurityUpdates"&gt;https://help.ubuntu.com/community/AutomaticSecurityUpdates&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://spin.atomicobject.com/2014/08/04/debian-ubuntu-security-updates/"&gt;https://spin.atomicobject.com/2014/08/04/debian-ubuntu-security-updates/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="Ubunu"></category><category term="Debian"></category></entry><entry><title>MySQL自动备份，并同步到AmazonS3</title><link href="http://blog.wiseturtles.com/posts/MySQL-backup-to-Amazon-S3.html" rel="alternate"></link><published>2016-04-05T11:39:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-04-05:posts/MySQL-backup-to-Amazon-S3.html</id><summary type="html">&lt;p&gt;MySQL自动备份，并将本地备份同步到Amazon&amp;nbsp;S3，然后配置邮件通知。&lt;/p&gt;
&lt;p&gt;注: 系统为Ubuntu&amp;nbsp;14.04，Debian系统也类似。&lt;/p&gt;
&lt;h2&gt;安装automysqlbackup&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install automysqlbackup
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;配置automysqlbackup&lt;/h2&gt;
&lt;h3&gt;参数介绍&lt;/h3&gt;
&lt;p&gt;配置文件路径: &lt;code&gt;/etc/default/automysqlbackup&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;主要参数:
&lt;span class="caps"&gt;USERNAME&lt;/span&gt; - 数据库登陆用户名
&lt;span class="caps"&gt;PASSWORD&lt;/span&gt; - 数据库登陆密码
&lt;span class="caps"&gt;DBHOST&lt;/span&gt; - 数据库主机名或&lt;span class="caps"&gt;IP&lt;/span&gt;地址
&lt;span class="caps"&gt;DBNAMES&lt;/span&gt; - 需要备份的MySQL数据库
&lt;span class="caps"&gt;BACKUPDIR&lt;/span&gt; - 备份文件存放路径
&lt;span class="caps"&gt;SOCKET&lt;/span&gt; - MySQL服务的本地unix socket路径
&lt;span class="caps"&gt;MAILCONTENT&lt;/span&gt; - 发送邮件内容，可以为: log, files, stdout, quiet
&lt;span class="caps"&gt;MAXATTSIZE&lt;/span&gt; - 最大允许的邮件内容大小
&lt;span class="caps"&gt;MAILADDR&lt;/span&gt; - 接收通知的邮箱地址
&lt;span class="caps"&gt;PREBACKUP&lt;/span&gt; - 备份前运行的脚本
&lt;span class="caps"&gt;POSTBACKUP&lt;/span&gt; -&amp;nbsp;备份后运行的脚本&lt;/p&gt;
&lt;p&gt;其它参数参考 &lt;code&gt;/etc/default/automysqlbackup&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;修改&lt;code&gt;DBNAMES&lt;/code&gt;, &lt;code&gt;BACKUPDIR&lt;/code&gt;，指定需要备份的数据库名称和备份文件存放路径。&lt;/p&gt;
&lt;h3&gt;发送邮件通知&lt;/h3&gt;
&lt;p&gt;修改&lt;code&gt;MAILCONTENT&lt;/code&gt;, &lt;code&gt;MAILADDR&lt;/code&gt;指定发送什么内容到指定邮箱。&lt;/p&gt;
&lt;p&gt;注:&amp;nbsp;先确保通过postfix在命令行可以发送邮件到你的邮箱.&lt;/p&gt;
&lt;h3&gt;备份到Amazon&amp;nbsp;S3&lt;/h3&gt;
&lt;p&gt;安装s3cmd，使用s3cmd同步备份文件到Amazon&amp;nbsp;S3。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo pip install s3cmd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改&lt;code&gt;POSTBACKUP&lt;/code&gt;，备份完成后同步备份文件到Amazon&amp;nbsp;S3。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;POSTBACKUP=/etc/automysqlbackup/mysql-backup-post
$ cat /etc/automysqlbackup/mysql-backup-post
#!/bin/bash

sudo /usr/local/bin/s3cmd -c /home/user/.s3cfg -r sync local-automysqlbackup-path s3://your-backup-bucket/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注: 备份前配置s3cmd，确保它有权限操作你的S3&amp;nbsp;bucket&lt;/p&gt;</summary><category term="mysql"></category><category term="backup"></category><category term="S3"></category></entry><entry><title>Gerrit备份</title><link href="http://blog.wiseturtles.com/posts/Gerrit-backup.html" rel="alternate"></link><published>2016-03-11T18:52:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2016-03-11:posts/Gerrit-backup.html</id><summary type="html">&lt;p&gt;将Gerrit实时同步到其它系统完成Gerrit git repos备份。通常用这种方式完成Gerrit&amp;nbsp;Mirror。&lt;/p&gt;
&lt;h2&gt;通过Gerrit replication&amp;nbsp;plugin完成Gerrit同步&lt;/h2&gt;
&lt;h3&gt;安装buck&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ sudo apt-get install ant
ubuntu@gerrit$ &lt;span class="nb"&gt;cd&lt;/span&gt; ~/download
ubuntu@gerrit$ git clone https://github.com/facebook/buck.git
ubuntu@gerrit$ &lt;span class="nb"&gt;cd&lt;/span&gt; buck
ubuntu@gerrit$ ant  &lt;span class="c1"&gt;# 编译完成后 buck 可执行文件就在当前的bin目录&lt;/span&gt;
ubuntu@gerrit$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;export PATH=$HOME/download/buck/bin:$PATH&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bashrc
ubuntu@gerrit$ &lt;span class="nb"&gt;source&lt;/span&gt; ~/.bashrc
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;编译replication&amp;nbsp;plugin&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ git clone https://gerrit.googlesource.com/gerrit
ubuntu@gerrit$ git checkout -b v2.11.4-tag v2.11.4  &lt;span class="c1"&gt;# 我gerrit版本是2.11.4&lt;/span&gt;
ubuntu@gerrit$ git submodule update --init --recursive
ubuntu@gerrit$ buck build plugins/replication:replication
ubuntu@gerrit$ cp buck-out/gen/plugins/replication/replication.jar /tmp
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;安装replication&amp;nbsp;plugin&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ ssh -p &lt;span class="m"&gt;29418&lt;/span&gt; localhost gerrit plugin install -n replication.jar - &amp;lt;/tmp/replication.jar
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;配置replication&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ cat etc/replication.config
&lt;span class="o"&gt;[&lt;/span&gt;remote &lt;span class="s2"&gt;&amp;quot;gerrit-backup&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="nv"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ubuntu@10.x.x.x:/data/gerrit-backup/git/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.git
    &lt;span class="nv"&gt;push&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; +refs/heads/*:refs/heads/*
    &lt;span class="nv"&gt;push&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; +refs/tags/*:refs/tags/*
    &lt;span class="nv"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 30
    &lt;span class="nv"&gt;threads&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 3
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;同步一份代码到backup&amp;nbsp;gerrit&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit-backup $ sudo mkdir -p /data/gerrit-backup
ubuntu@gerrit-backup $ sudo chown -R ubuntu /data
ubuntu@gerrit-backup $ &lt;span class="nb"&gt;exit&lt;/span&gt;  &lt;span class="c1"&gt;# 退出gerrit-backup&lt;/span&gt;

ubuntu@gerrit$ &lt;span class="nb"&gt;cd&lt;/span&gt; ~/apps/gerrit/review_site  &lt;span class="c1"&gt;# 登陆gerrit,并进入Gerrit目录&lt;/span&gt;
ubuntu@gerrit$ tar cf - git &lt;span class="p"&gt;|&lt;/span&gt; ssh gerrit-backup &lt;span class="s2"&gt;&amp;quot;cd /data/gerrit-backup &amp;amp;&amp;amp; tar xf -&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;开始同步&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ ssh -p &lt;span class="m"&gt;29418&lt;/span&gt; localhost gerrit plugin reload replication  &lt;span class="c1"&gt;# reload&lt;/span&gt;
ubuntu@gerrit$ ssh -p &lt;span class="m"&gt;29418&lt;/span&gt; localhost replication start --wait --all  &lt;span class="c1"&gt;# start replication&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Gerrit&amp;nbsp;MySQL备份&lt;/h2&gt;
&lt;p&gt;通过automysqlbackup备份MySQL数据到本地文件系统.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ubuntu@gerrit$ sudo apt-get install automysqlbackup
ubuntu@gerrit$ sudo automysqlbackup  &lt;span class="c1"&gt;# 运行automysqlbackup测试是否可以备份，可能需要修改 /etc/default/automysqlbackup 和 /etc/mysql* 配置文件&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果需要可以将MySQL数据定期同步到Amazon&amp;nbsp;S3等系统存储.&lt;/p&gt;
&lt;h2&gt;参考文档:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gerrit.googlesource.com/gerrit/+/v2.0.2/Documentation/config-replication.txt"&gt;config-replication.txt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary><category term="Gerrit"></category><category term="replication"></category><category term="MySQL"></category></entry><entry><title>Python Gevent安装报错</title><link href="http://blog.wiseturtles.com/posts/gevent-install-error.html" rel="alternate"></link><published>2015-10-31T20:46:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-10-31:posts/gevent-install-error.html</id><summary type="html">&lt;p&gt;Mac上pip安装gevent报错信息如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;libev/ev.c:1029:42: error: &amp;#39;_Noreturn&amp;#39; keyword must precede function declarator
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;解决：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nv"&gt;CFLAGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-std=c99&amp;#39;&lt;/span&gt; pip install gevent
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里有讨论：https://github.com/NixOS/nixpkgs/issues/8569&lt;/p&gt;</summary><category term="python"></category><category term="pip"></category><category term="gevent"></category></entry><entry><title>Android命令行工具</title><link href="http://blog.wiseturtles.com/posts/Android-command-line-tools.html" rel="alternate"></link><published>2015-10-27T19:52:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-10-27:posts/Android-command-line-tools.html</id><summary type="html">&lt;h2&gt;Android命令行工具&lt;/h2&gt;
&lt;h3&gt;android&lt;/h3&gt;
&lt;p&gt;下面介绍命令行下使用android脚本。&lt;/p&gt;
&lt;p&gt;场景：命令行下安装android build tools、sdk、&lt;span class="caps"&gt;API&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;获取所有可用的包:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ android list sdk -a -u
$ android list sdk -a -u --proxy-host proxy-host --proxy-port proxy-port  &lt;span class="c1"&gt;# 设置代理&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;安装指定的包：(num1,&amp;nbsp;num2是上面命令返回的序号)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ android update sdk -u -a -t &amp;lt;num1,num2&amp;gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Android"></category></entry><entry><title>Python Pypi源</title><link href="http://blog.wiseturtles.com/posts/config-python-pip.html" rel="alternate"></link><published>2015-10-15T21:52:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-10-15:posts/config-python-pip.html</id><summary type="html">&lt;h2&gt;pip安装&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ wget https://bootstrap.pypa.io/get-pip.py
$ sudo python get-pip.py
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或者，直接使用发行版的包管理安装:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install python-pip  &lt;span class="c1"&gt;# Debian/Ubuntu&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;pip配置&lt;/h2&gt;
&lt;p&gt;官方源比较慢，上面是一些国内源。&lt;/p&gt;
&lt;h3&gt;国内pypi源&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;https://pypi.mirrors.ustc.edu.cn/simple/&lt;/li&gt;
&lt;li&gt;http://mirrors.aliyun.com/pypi/simple/&lt;/li&gt;
&lt;li&gt;http://pypi.v2ex.com/simple&lt;/li&gt;
&lt;li&gt;http://pypi.douban.com/&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;修改pip默认源&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat .pip/pip.conf
&lt;span class="o"&gt;[&lt;/span&gt;global&lt;span class="o"&gt;]&lt;/span&gt;
trusted-host &lt;span class="o"&gt;=&lt;/span&gt; mirrors.aliyun.com
index-url &lt;span class="o"&gt;=&lt;/span&gt; http://mirrors.aliyun.com/pypi/simple/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果使用阿里云主机，请用下面的地址:
index-url =&amp;nbsp;http://mirrors.aliyuncs.com/pypi/simple/&lt;/p&gt;
&lt;p&gt;不加trusted-host会报下面的警告:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The repository located at mirrors.aliyun.com is not a trusted or secure host and is being ignored. If this repository is available via &lt;span class="caps"&gt;HTTPS&lt;/span&gt; it is recommended to use &lt;span class="caps"&gt;HTTPS&lt;/span&gt; instead, otherwise you may silence this warning and allow it anyways with &amp;#8216;&amp;#8212;trusted-host&amp;nbsp;mirrors.aliyun.com&amp;#8217;.&lt;/p&gt;
&lt;/blockquote&gt;</summary><category term="python"></category><category term="pip"></category><category term="pypi"></category></entry><entry><title>Nginx配置SSL证书</title><link href="http://blog.wiseturtles.com/posts/nginx-config-ssl-certificate.html" rel="alternate"></link><published>2015-10-10T13:27:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-10-10:posts/nginx-config-ssl-certificate.html</id><summary type="html">&lt;p&gt;本文参考:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.cocoachina.com/ios/20150703/12392.html"&gt;http://www.cocoachina.com/ios/20150703/12392.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://hack0nair.me/2014-08-14-nginx-with-ssl-of-wosign/"&gt;https://hack0nair.me/2014-08-14-nginx-with-ssl-of-wosign/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://note.sdo.com/u/634668972018478681/n/Z1NG3C6A959F29DD2FA2D543B8C9B30B551810C3"&gt;http://note.sdo.com/u/634668972018478681/n/&lt;span class="caps"&gt;Z1NG3C6A959F29DD2FA2D543B8C9B30B551810C3&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://op.baidu.com/2015/04/https-s01a01/"&gt;http://op.baidu.com/2015/04/https-s01a01/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://oncenote.com/2014/10/21/Security-1-HTTPS/"&gt;http://oncenote.com/2014/10/21/Security-1-&lt;span class="caps"&gt;HTTPS&lt;/span&gt;/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://oncenote.com/2015/09/16/Security-2-HTTPS2/"&gt;http://oncenote.com/2015/09/16/Security-2-&lt;span class="caps"&gt;HTTPS2&lt;/span&gt;/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.vobe.io/114"&gt;https://www.vobe.io/114&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Nginx配置&lt;span class="caps"&gt;SSL&lt;/span&gt;证书, 启用&lt;span class="caps"&gt;HTTPS&lt;/span&gt;&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;iOS9把所有的http请求都改为https了：iOS9系统发送的网络请求将统一使用&lt;span class="caps"&gt;TLS&lt;/span&gt; 1.2 &lt;span class="caps"&gt;SSL&lt;/span&gt;。
采用&lt;span class="caps"&gt;TLS&lt;/span&gt; 1.2 协议，目的是 强制增强数据访问安全，而且 系统 Foundation 框架下的相关网络请求，
将不再默认使用 Http 等不安全的网络协议，而默认采用 &lt;span class="caps"&gt;TLS&lt;/span&gt; 1.2。服务器因此需要更新，以解析相关数据。
如不更新，可通过在 Info.plist&amp;nbsp;中声明，倒退回不安全的网络请求。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为了客户端接口更加安全，申请免费&lt;span class="caps"&gt;SSL&lt;/span&gt;证书，启用&lt;span class="caps"&gt;HTTPS&lt;/span&gt;。&lt;/p&gt;
&lt;h2&gt;申请证书&lt;/h2&gt;
&lt;p&gt;从Wosign申请免费证书，&lt;a href="https://www.wosign.com/DVSSL/DV_KuaiSSL_Free.htm"&gt;地址&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;配置Nginx&lt;/h2&gt;
&lt;p&gt;证书申请到会提示下载一个zip文件，解压缩后有 &lt;code&gt;for Nginx.zip&lt;/code&gt;，解压缩&lt;code&gt;for Nginx.zip&lt;/code&gt;得到 &lt;code&gt;*.crt&lt;/code&gt; 和 &lt;code&gt;*.key&lt;/code&gt;。
将&lt;code&gt;.crt&lt;/code&gt; 和 &lt;code&gt;.key&lt;/code&gt; 文件放入Nginx主机的 /etc/ssl&amp;nbsp;目录。&lt;/p&gt;
&lt;p&gt;生成dhparam.pem:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /etc/ssl/certs
$ openssl dhparam -out dhparam.pem 4096
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;同时，启用了spdy，参考: &lt;a href="https://www.vobe.io/114"&gt;https://www.vobe.io/114&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Nginx配置文件(&lt;code&gt;/etc/nginx/sites-avaiable/default&lt;/code&gt;)如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nn"&gt;#server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="err"&gt;#&lt;/span&gt;   &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;#&lt;/span&gt;   &lt;span class="n"&gt;server_name&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;#&lt;/span&gt;   &lt;span class="n"&gt;add_header&lt;/span&gt; &lt;span class="n"&gt;Strict&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Transport&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Security&lt;/span&gt; &lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;15768000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;#&lt;/span&gt;   &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="m"&gt;301&lt;/span&gt; &lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;如果希望&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="err"&gt;直接跳转到&lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="err"&gt;，删除该行，并去掉上面的注释&lt;/span&gt;
    &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;443&lt;/span&gt; &lt;span class="n"&gt;ssl&lt;/span&gt; &lt;span class="n"&gt;spdy&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;spdy_headers_comp&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;server_name&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;ssl&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;ssl_certificate&lt;/span&gt;      &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssl&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;ssl_certificate_key&lt;/span&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssl&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;ssl_protocols&lt;/span&gt; &lt;span class="n"&gt;TLSv1&lt;/span&gt; &lt;span class="n"&gt;TLSv1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="n"&gt;TLSv1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;ssl_ciphers&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;AES256+EECDH:AES256+EDH:!aNULL&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="m"&gt;#ssl&lt;/span&gt;&lt;span class="n"&gt;_ciphers&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&amp;quot;&lt;/span&gt;

    &lt;span class="n"&gt;ssl_prefer_server_ciphers&lt;/span&gt;  &lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;ssl_dhparam&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssl&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;certs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dhparam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;ssl_session_cache&lt;/span&gt;    &lt;span class="n"&gt;shared&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;SSL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;ssl_session_timeout&lt;/span&gt;  &lt;span class="m"&gt;60&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;ssl_stapling&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;ssl_stapling_verify&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="m"&gt;#ssl&lt;/span&gt;&lt;span class="n"&gt;_trusted_certificate&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cert&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;trustchain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="m"&gt;#resolv&lt;/span&gt;&lt;span class="n"&gt;er&lt;/span&gt; &lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt; &lt;span class="n"&gt;valid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;300s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="m"&gt;#resolv&lt;/span&gt;&lt;span class="n"&gt;er_timeout&lt;/span&gt; &lt;span class="m"&gt;10s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;add_header&lt;/span&gt; &lt;span class="n"&gt;Strict&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Transport&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Security&lt;/span&gt; &lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;15768000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;add_header&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Frame&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="n"&gt;DENY&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;add_header&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Content&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="n"&gt;nosniff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;add_header&lt;/span&gt; &lt;span class="n"&gt;Alternate&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Protocol&lt;/span&gt; &lt;span class="m"&gt;443&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;npn&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;spdy&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="n"&gt;Host&lt;/span&gt;                 &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;http_host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Forwarded&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Proto&lt;/span&gt;    &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;scheme&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Forwarded&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;For&lt;/span&gt;      &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;remote_addr&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;proxy_redirect&lt;/span&gt;     &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;your&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;proxy_pass&lt;/span&gt;         &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;8888&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;测试&lt;span class="caps"&gt;HTTPS&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;curl测试服务器上的https接口:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl https://your-domain/your-services
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;测试&lt;span class="caps"&gt;HTTPS&lt;/span&gt;配置的是否安全：&lt;a href="https://www.ssllabs.com/ssltest/"&gt;https://www.ssllabs.com/ssltest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;注：如果安全评分比较低，请认真阅读&lt;a href="http://note.sdo.com/u/634668972018478681/n/Z1NG3C6A959F29DD2FA2D543B8C9B30B551810C3"&gt;Strong &lt;span class="caps"&gt;SSL&lt;/span&gt; Security on&amp;nbsp;nginx&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;测试&lt;span class="caps"&gt;SPDY&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;检测配置的&lt;span class="caps"&gt;SPDY&lt;/span&gt;：&lt;a href="https://spdycheck.org/"&gt;https://spdycheck.org/&lt;/a&gt;&lt;/p&gt;</summary><category term="nginx"></category><category term="ssl"></category><category term="https"></category></entry><entry><title>iptables配置</title><link href="http://blog.wiseturtles.com/posts/iptables-on-debian-centos.html" rel="alternate"></link><published>2015-09-23T16:40:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-09-23:posts/iptables-on-debian-centos.html</id><summary type="html">&lt;p&gt;最近使用阿里云&lt;span class="caps"&gt;ECS&lt;/span&gt;，发现既然没有提供安全组，能让小白用户方便的配置下允许外网访问的端口。&amp;nbsp;默认所有绑定到外网ip或四个零的端口，外网都可以访问，然后，看看iptables文档，自己来配下咯。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://sentry.readthedocs.org/en/stable/index.html#"&gt;官方安装文档&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;安装iptables&lt;/h2&gt;
&lt;h3&gt;Debian&lt;/h3&gt;
&lt;p&gt;安装:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install iptables
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Debian系统中不需要启动iptables。&lt;/p&gt;
&lt;h3&gt;CentOS&lt;/h3&gt;
&lt;p&gt;安装:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo yum install iptables -y
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;启动:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo service iptables start
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;配置iptables&lt;/h3&gt;
&lt;p&gt;配置指令Debian、CentOS都一样。&lt;/p&gt;
&lt;p&gt;这两段抄的&lt;a href="http://blog.kkyun.com/?p=50"&gt;kkyun&amp;nbsp;blog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;清除防火墙规则:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;```
#首先在清除前要将policy INPUT改成ACCEPT,表示接受一切请求。
#这个一定要先做，不然清空后可能会悲剧
$ sudo iptables -P INPUT ACCEPT

#清空默认所有规则
$ sudo iptables -F

#清空自定义的所有规则
$ sudo iptables -X

#计数器置0
$ sudo iptables -Z
```
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;常用配置:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;```
# 允许来自于lo接口的数据包
# 如果没有此规则，你将不能通过127.0.0.1访问本地服务，例如ping 127.0.0.1
$ sudo iptables -A INPUT -i lo -j ACCEPT

# ssh端口22
$ sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# FTP端口21
$ sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT

# web服务端口80
$ sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# tomcat
$ sudo iptables -A INPUT -p tcp --dport xxxx -j ACCEPT

# mysql
$ sudo iptables -A INPUT -p tcp --dport xxxx -j ACCEPT

#允许icmp包通过,也就是允许ping
$ sudo iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

#允许所有对外请求的返回包
#本机对外请求相当于OUTPUT,对于返回数据包必须接收啊，这相当于INPUT了
$ sudo iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT

#如果要添加内网ip信任（接受其所有TCP请求）
$ sudo iptables -A INPUT -p tcp -s 45.96.174.68 -j ACCEPT

#过滤所有非以上规则的请求
$ sudo iptables -P INPUT DROP

#要封停一个IP，使用下面这条命令：
$ sudo iptables -I INPUT -s ***.***.***.*** -j DROP

#要解封一个IP，使用下面这条命令:
$ sudo iptables -D INPUT -s ***.***.***.*** -j DROP
```
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;保存iptables配置&lt;/h3&gt;
&lt;p&gt;iptables配置好在当前环境生效，但，重启系统就不再可用。&amp;nbsp;所以，我们需要将iptables配置信息保存下来，并在下次系统开机时自动加载。&lt;/p&gt;
&lt;h4&gt;Debian&lt;/h4&gt;
&lt;p&gt;重启时自动加载iptables配置信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install iptables-persistent
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;CentOS&lt;/h4&gt;
&lt;p&gt;保存iptables配置信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo service iptables save
iptables: Saving firewall rules to /etc/sysconfig/iptables:&lt;span class="o"&gt;[&lt;/span&gt;  OK  &lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;重启自动运行iptables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo chkconfig iptables on
&lt;/pre&gt;&lt;/div&gt;</summary><category term="iptables"></category></entry><entry><title>Debian 8.2上安装Sentry</title><link href="http://blog.wiseturtles.com/posts/setup-sentry-on-debian-8.2.html" rel="alternate"></link><published>2015-09-22T15:55:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-09-22:posts/setup-sentry-on-debian-8.2.html</id><summary type="html">&lt;p&gt;Sentry是一个很好用的错误、异常收集平台，支持Python, Node.js, &lt;span class="caps"&gt;PHP&lt;/span&gt;, Ruby, Java,&amp;nbsp;Go以及Android、iOS。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://sentry.readthedocs.org/en/stable/index.html#"&gt;官方安装文档&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;系统环境&lt;/h2&gt;
&lt;p&gt;查看系统版本。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ lsb_release -a
No LSB modules are available.
Distributor ID: Debian
Description:    Debian GNU/Linux 8.2 &lt;span class="o"&gt;(&lt;/span&gt;jessie&lt;span class="o"&gt;)&lt;/span&gt;
Release:    8.2
Codename:   jessie
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;准备数据库环境&lt;/h2&gt;
&lt;p&gt;virtualenv的安装、配置就不再介绍了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install postgresql libpq-dev
$ mkvirtualenv sentry
&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ pip install psycopg2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在PostgreSQL中为sentry创建数据库。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo -u postgre createuser --superuser sentry
$ sudo -u sentry psql
&lt;span class="nv"&gt;postgres&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="c1"&gt;# \password sentry&lt;/span&gt;
Enter new password:
Enter it again:
&lt;span class="nv"&gt;postgres&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="c1"&gt;# \q&lt;/span&gt;
$ sudo -u sentry createdb -E utf8 sentry
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;安装sentry&lt;/h2&gt;
&lt;p&gt;数据库使用的是PostgreSQL，使用公司邮件服务器发送邮件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ workon sentry
&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ pip install sentry
&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry init /tmp/settings.py
&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sudo mv /tmp/settings.py /etc/sentry/sentry.conf.py
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/sentry/sentry.conf.py中的数据库配置如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;DATABASES&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;default&amp;#39;&lt;/span&gt;: &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;# You can swap out the engine for MySQL easily by changing this value&lt;/span&gt;
        &lt;span class="c1"&gt;# to ``django.db.backends.mysql`` or to PostgreSQL with&lt;/span&gt;
        &lt;span class="c1"&gt;# ``sentry.db.postgres``&lt;/span&gt;

        &lt;span class="c1"&gt;# If you change this, you&amp;#39;ll also need to install the appropriate python&lt;/span&gt;
        &lt;span class="c1"&gt;# package: psycopg2 (Postgres) or mysql-python&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;ENGINE&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;django.db.backends.postgresql_psycopg2&amp;#39;&lt;/span&gt;,

        &lt;span class="s1"&gt;&amp;#39;NAME&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;sentry&amp;#39;&lt;/span&gt;,
        &lt;span class="s1"&gt;&amp;#39;USER&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;sentry&amp;#39;&lt;/span&gt;,
        &lt;span class="s1"&gt;&amp;#39;PASSWORD&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;xxxx&amp;#39;&lt;/span&gt;,
        &lt;span class="s1"&gt;&amp;#39;HOST&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;,
        &lt;span class="s1"&gt;&amp;#39;PORT&amp;#39;&lt;/span&gt;: &lt;span class="s1"&gt;&amp;#39;5432&amp;#39;&lt;/span&gt;,
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/sentry/sentry.conf.py中的Web服务配置如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# You MUST configure the absolute URI root for Sentry:&lt;/span&gt;
&lt;span class="nv"&gt;SENTRY_URL_PREFIX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://your-ip&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# No trailing slash!&lt;/span&gt;

&lt;span class="nv"&gt;SENTRY_WEB_HOST&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;SENTRY_WEB_PORT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 9000
&lt;span class="nv"&gt;SENTRY_WEB_OPTIONS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;workers&amp;#39;&lt;/span&gt;: 4,  &lt;span class="c1"&gt;# the number of gunicorn workers&lt;/span&gt;
    &lt;span class="c1"&gt;# &amp;#39;secure_scheme_headers&amp;#39;: {&amp;#39;X-FORWARDED-PROTO&amp;#39;: &amp;#39;https&amp;#39;},&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/sentry/sentry.conf.py中的邮件配置根据个人情况修改。&lt;/p&gt;
&lt;p&gt;修改完配置运行如下命令:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py upgrade
&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py repair
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;创建sentry超级用户:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py createsuperuser
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;启动Web服务命令如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py start
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;启动后就可以访问 http://your-ip:9000&amp;nbsp;了，用刚才创建的超级用户登录。&lt;/p&gt;
&lt;p&gt;启动sentry&amp;nbsp;worker:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;sentry&lt;span class="o"&gt;)&lt;/span&gt;$ sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py celery worker -B -l WARNING
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;正式环境运行sentry&lt;/h2&gt;
&lt;h3&gt;supervisor管理sentry,&amp;nbsp;sentry_worker&lt;/h3&gt;
&lt;p&gt;通过supervisor管理sentry,&amp;nbsp;sentry_worker；并用nginx做反向代理。&lt;/p&gt;
&lt;p&gt;supervisor的安装也不再介绍。&lt;/p&gt;
&lt;p&gt;supervisor管理sentry:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/supervisor/conf.d/sentry.conf
&lt;span class="o"&gt;[&lt;/span&gt;program:sentry&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="c1"&gt;#directory=/var/www/.virtualenvs/sentry/bin/&lt;/span&gt;
&lt;span class="nv"&gt;environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;VIRTUAL_ENV_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/www/.virtualenvs/sentry/bin/&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/www/.virtualenvs/sentry/bin/sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py start
&lt;span class="nv"&gt;user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;develop
&lt;span class="nv"&gt;stdout_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/sentry.stdout
&lt;span class="nv"&gt;stderr_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/sentry.stderr
&lt;span class="nv"&gt;autostart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;autorestart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;killasgroup&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;supervisor管理sentry_worker:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/supervisor/conf.d/sentry_worker.conf
&lt;span class="o"&gt;[&lt;/span&gt;program:sentry_worker&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="c1"&gt;#directory=/var/www/.virtualenvs/sentry/bin/&lt;/span&gt;
&lt;span class="nv"&gt;environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;VIRTUAL_ENV_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/www/.virtualenvs/sentry/bin/&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/www/.virtualenvs/sentry/bin/sentry --config&lt;span class="o"&gt;=&lt;/span&gt;/etc/sentry/sentry.conf.py celery worker -B -l WARNING
&lt;span class="nv"&gt;user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;develop
&lt;span class="nv"&gt;stdout_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/sentry_worker.stdout
&lt;span class="nv"&gt;stderr_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/sentry_worker.stderr
&lt;span class="nv"&gt;autostart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;autorestart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;killasgroup&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;启动sentry,&amp;nbsp;sentry_worker:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo service supervisor restart
$ sudo supervisorctl  &lt;span class="c1"&gt;# 查看sentry, sentry_worker运行情况&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;配置Nginx&lt;/h3&gt;
&lt;p&gt;/etc/nginx/sites-available/default的server配置中增加如下内容:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;```&lt;/span&gt;
&lt;span class="nt"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="nt"&gt;Host&lt;/span&gt;                 &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;http_host&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="nt"&gt;X-Real-IP&lt;/span&gt;            &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;remote_addr&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="nt"&gt;X-Forwarded-For&lt;/span&gt;      &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;proxy_add_x_forwarded_for&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;proxy_set_header&lt;/span&gt;   &lt;span class="nt"&gt;X-Forwarded-Proto&lt;/span&gt;    &lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nt"&gt;scheme&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;proxy_redirect&lt;/span&gt;     &lt;span class="nt"&gt;off&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;proxy_pass&lt;/span&gt;         &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;9000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;~*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;api&lt;/span&gt;&lt;span class="o"&gt;/(?&lt;/span&gt;&lt;span class="nt"&gt;P&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;projectid&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="nt"&gt;d&lt;/span&gt;&lt;span class="o"&gt;+/)?&lt;/span&gt;&lt;span class="nt"&gt;store&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;proxy_pass&lt;/span&gt;        &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="m"&gt;127&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;9000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="err"&gt;```&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;重启nginx，并通过http://your-ip&amp;nbsp;访问。&lt;/p&gt;
&lt;h2&gt;测试&lt;/h2&gt;
&lt;p&gt;开始我们就提到过sentry支持目前所有主流语言，
参考&lt;a href="https://docs.getsentry.com/hosted/clients/python/"&gt;这里&lt;/a&gt;&amp;nbsp;可以检查是否能将错误、异常发生到自己搭建的sentry。&lt;/p&gt;</summary><category term="sentry"></category></entry><entry><title>Gitlab安装</title><link href="http://blog.wiseturtles.com/posts/gitlab-setup-on-centos6.html" rel="alternate"></link><published>2015-09-18T13:13:00+08:00</published><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-09-18:posts/gitlab-setup-on-centos6.html</id><summary type="html">&lt;p&gt;公司没有统一的代码管理平台，虽然曾经用过stash、jira、confluence，但调研后还是觉得用gitlab。&amp;nbsp;下面介绍下gitlab安装、配置。&lt;/p&gt;
&lt;h2&gt;系统环境&lt;/h2&gt;
&lt;p&gt;查看系统版本。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/issue
CentOS release 6.6 &lt;span class="o"&gt;(&lt;/span&gt;Final&lt;span class="o"&gt;)&lt;/span&gt;
Kernel &lt;span class="se"&gt;\r&lt;/span&gt; on an &lt;span class="se"&gt;\m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;安装gitlab&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://about.gitlab.com/downloads/#centos6"&gt;官方安装文档&lt;/a&gt;介绍的比较详细，&amp;nbsp;我用公司邮箱发送邮件，所以，没有安装postfix。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo yum install curl openssh-server cronie
$ sudo lokkit -s http -s ssh
$ curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh &lt;span class="p"&gt;|&lt;/span&gt; sudo bash
$ sudo yum install gitlab-ce
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;配置gitlab&lt;/h2&gt;
&lt;p&gt;数据库使用的是PostgreSQL，使用公司邮件服务器。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;--- /etc/gitlab/gitlab.rb.back  2015-09-07 16:31:05.247042700 +0800
+++ /etc/gitlab/gitlab.rb   2015-09-09 14:47:33.710061343 +0800
@@ -3,7 +3,7 @@
&lt;span class="c1"&gt;## Url on which GitLab will be reachable.&lt;/span&gt;
&lt;span class="c1"&gt;## For more details on configuring external_url see:&lt;/span&gt;
&lt;span class="c1"&gt;## https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#configuring-the-external-url-for-gitlab&lt;/span&gt;
-external_url &lt;span class="s1"&gt;&amp;#39;http://iZ23rkm97f5Z&amp;#39;&lt;/span&gt;
+external_url &lt;span class="s1"&gt;&amp;#39;http://your-git-domain&amp;#39;&lt;/span&gt;


&lt;span class="c1"&gt;## Note: configuration settings below are optional.&lt;/span&gt;
@@ -14,23 +14,23 @@

&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;gitlab_ssh_host&amp;#39;] = &amp;#39;ssh.host_example.com&amp;#39;&lt;/span&gt;
gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;time_zone&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;UTC&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_enabled&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_from&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;example@example.com&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_display_name&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Example&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_reply_to&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;noreply@example.com&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_can_create_group&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_username_changing_enabled&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_theme&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 2
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_restricted_visibility_levels&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil &lt;span class="c1"&gt;# to restrict public and internal: [&amp;#39;public&amp;#39;, &amp;#39;internal&amp;#39;]&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_issues&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_merge_requests&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_wiki&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_snippets&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_visibility_level&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;private&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_repository_downloads_path&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tmp/repositories&amp;#39;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_enabled&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_from&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;noreply@yourdomain&amp;#39;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_display_name&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Gitlab&amp;#39;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_email_reply_to&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;noreply@yourdomain&amp;#39;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_can_create_group&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_username_changing_enabled&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_theme&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 2
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_restricted_visibility_levels&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;public&amp;#39;&lt;/span&gt;, &lt;span class="s1"&gt;&amp;#39;internal&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;# to restrict public and internal: [&amp;#39;public&amp;#39;, &amp;#39;internal&amp;#39;]&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_issues&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_merge_requests&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_wiki&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_snippets&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_default_projects_features_visibility_level&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;private&amp;#39;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_repository_downloads_path&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tmp/repositories&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;gravatar_plain_url&amp;#39;] = &amp;#39;http://www.gravatar.com/avatar/%{hash}?s=%{size}&amp;amp;d=identicon&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;gravatar_ssl_url&amp;#39;] = &amp;#39;https://secure.gravatar.com/avatar/%{hash}?s=%{size}&amp;amp;d=identicon&amp;#39;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;webhook_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;webhook_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10

&lt;span class="c1"&gt;## For setting up LDAP&lt;/span&gt;
&lt;span class="c1"&gt;## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#setting-up-ldap-sign-in&lt;/span&gt;
@@ -107,9 +107,9 @@
&lt;span class="c1"&gt;## For setting up backups&lt;/span&gt;
&lt;span class="c1"&gt;## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#backups&lt;/span&gt;

-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_path&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/backups&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_archive_permissions&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0644&lt;/span&gt; &lt;span class="c1"&gt;# See: http://doc.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_keep_time&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 604800
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_path&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/backups&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_archive_permissions&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0644&lt;/span&gt; &lt;span class="c1"&gt;# See: http://doc.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backup_keep_time&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 604800
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;backup_upload_connection&amp;#39;] = {&lt;/span&gt;
&lt;span class="c1"&gt;#   &amp;#39;provider&amp;#39; =&amp;gt; &amp;#39;AWS&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#   &amp;#39;region&amp;#39; =&amp;gt; &amp;#39;eu-west-1&amp;#39;,&lt;/span&gt;
@@ -128,9 +128,9 @@
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;satellites_timeout&amp;#39;] = 30&lt;/span&gt;

&lt;span class="c1"&gt;## GitLab Shell settings for GitLab&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_shell_ssh_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 22
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git_max_size&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 20971520
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gitlab_shell_ssh_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 22
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git_max_size&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 20971520
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10

&lt;span class="c1"&gt;## Extra customization&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;extra_google_analytics_id&amp;#39;] = &amp;#39;_your_tracking_id&amp;#39;&lt;/span&gt;
@@ -161,9 +161,9 @@
&lt;span class="c1"&gt;# GitLab application settings #&lt;/span&gt;
&lt;span class="c1"&gt;###############################&lt;/span&gt;

-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uploads_directory&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/gitlab-rails/uploads&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate_limit_requests_per_period&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate_limit_period&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 60
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uploads_directory&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/gitlab-rails/uploads&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate_limit_requests_per_period&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate_limit_period&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 60

&lt;span class="c1"&gt;# Change the initial default admin password.&lt;/span&gt;
&lt;span class="c1"&gt;# Only applicable on inital setup, changing this setting after database is created and seeded&lt;/span&gt;
@@ -176,13 +176,13 @@
&lt;span class="c1"&gt;## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/settings/database.md#database-settings&lt;/span&gt;
&lt;span class="c1"&gt;## Only needed if you use an external database.&lt;/span&gt;

-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_adapter&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;postgresql&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_encoding&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;unicode&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_database&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlabhq_production&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_pool&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_username&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_host&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_adapter&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;postgresql&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_encoding&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;unicode&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_database&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_pool&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 10
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_username&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_host&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;db_port&amp;#39;] = 5432&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;db_socket&amp;#39;] = nil&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;db_sslmode&amp;#39;] = nil&lt;/span&gt;
@@ -206,15 +206,15 @@
&lt;span class="c1"&gt;# see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/settings/smtp.md#smtp-settings&lt;/span&gt;
&lt;span class="c1"&gt;# Use smtp instead of sendmail/postfix.&lt;/span&gt;

-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp.server&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 456
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_user_name&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp user&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp password&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_domain&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;example.com&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_authentication&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;login&amp;quot;&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable_starttls_auto&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_tls&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp.xxx.com&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 25
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_user_name&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;noreply@yourdomain&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;yourpassword&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_domain&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;yourdomain&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_authentication&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;login&amp;quot;&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable_starttls_auto&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
+gitlab_rails&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_tls&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;smtp_openssl_verify_mode&amp;#39;] = &amp;#39;none&amp;#39; # Can be: &amp;#39;none&amp;#39;, &amp;#39;peer&amp;#39;, &amp;#39;client_once&amp;#39;, &amp;#39;fail_if_no_peer_cert&amp;#39;, see http://api.rubyonrails.org/classes/ActionMailer/Base.html&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;smtp_ca_path&amp;#39;] = &amp;quot;/etc/ssl/certs&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_rails[&amp;#39;smtp_ca_file&amp;#39;] = &amp;quot;/etc/ssl/certs/ca-certificates.crt&amp;quot;&lt;/span&gt;
@@ -242,18 +242,18 @@
&lt;span class="c1"&gt;##################&lt;/span&gt;
&lt;span class="c1"&gt;## Tweak unicorn settings.&lt;/span&gt;

-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;worker_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 60
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;worker_processes&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 2
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;worker_timeout&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 60
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;worker_processes&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 2

&lt;span class="c1"&gt;## Advanced settings&lt;/span&gt;
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;listen&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 8080
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;socket&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket&amp;#39;&lt;/span&gt;
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pidfile&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/opt/gitlab/var/unicorn/unicorn.pid&amp;#39;&lt;/span&gt;
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;listen&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 8088
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;socket&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket&amp;#39;&lt;/span&gt;
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pidfile&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/opt/gitlab/var/unicorn/unicorn.pid&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# unicorn[&amp;#39;tcp_nopush&amp;#39;] = true&lt;/span&gt;
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backlog_socket&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 1024
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;backlog_socket&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 1024
&lt;span class="c1"&gt;# Make sure somaxconn is equal or higher then backlog_socket&lt;/span&gt;
-# unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;somaxconn&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 1024
+unicorn&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;somaxconn&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 1024
&lt;span class="c1"&gt;# We do not recommend changing this setting&lt;/span&gt;
&lt;span class="c1"&gt;# unicorn[&amp;#39;log_directory&amp;#39;] = &amp;quot;/var/log/gitlab/unicorn&amp;quot;&lt;/span&gt;

@@ -290,11 +290,11 @@
&lt;span class="c1"&gt;# GitLab PostgreSQL #&lt;/span&gt;
&lt;span class="c1"&gt;#####################&lt;/span&gt;

-# postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
-# postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;listen_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
-# postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 5432
-# postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data_dir&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/postgresql/data&amp;quot;&lt;/span&gt;
-# postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;shared_buffers&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;256MB&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# recommend value is 1/4 of total RAM, up to 14GB.&lt;/span&gt;
+postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;listen_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
+postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 5432
+postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data_dir&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/opt/gitlab/postgresql/data&amp;quot;&lt;/span&gt;
+postgresql&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;shared_buffers&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;256MB&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# recommend value is 1/4 of total RAM, up to 14GB.&lt;/span&gt;

&lt;span class="c1"&gt;## Advanced settings&lt;/span&gt;
&lt;span class="c1"&gt;# postgresql[&amp;#39;ha&amp;#39;] = false&lt;/span&gt;
@@ -326,7 +326,7 @@
&lt;span class="c1"&gt;################&lt;/span&gt;
&lt;span class="c1"&gt;## Can be disabled if you are using your own redis instance.&lt;/span&gt;

-# redis&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+redis&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="c1"&gt;# redis[&amp;#39;username&amp;#39;] = &amp;quot;gitlab-redis&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# redis[&amp;#39;uid&amp;#39;] = nil&lt;/span&gt;
&lt;span class="c1"&gt;# redis[&amp;#39;gid&amp;#39;] = nil&lt;/span&gt;
@@ -470,14 +470,14 @@
&lt;span class="c1"&gt;## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/settings/database.md#database-settings&lt;/span&gt;
&lt;span class="c1"&gt;## Only needed if you use an external database.&lt;/span&gt;

-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_adapter&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;postgresql&amp;quot;&lt;/span&gt;
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_encoding&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;unicode&amp;quot;&lt;/span&gt;
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_database&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab_ci_production&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_adapter&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;postgresql&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_encoding&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;unicode&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_database&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab_ci_production&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;db_pool&amp;#39;] = 10&lt;/span&gt;
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_username&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab_ci&amp;quot;&lt;/span&gt;
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_host&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
-# gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 5432
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_username&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gitlab_ci&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_host&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; nil
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 5432
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;db_socket&amp;#39;] = nil&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;db_sslmode&amp;#39;] = nil&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;db_sslrootcert&amp;#39;] = nil&lt;/span&gt;
@@ -497,6 +497,15 @@
&lt;span class="c1"&gt;###################################&lt;/span&gt;
&lt;span class="c1"&gt;## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/settings/smtp.md#smtp-settings&lt;/span&gt;

+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_address&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;smtp.xxx.com&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_port&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 25
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_user_name&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;noreply@yourdomain&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_password&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;yourpassword&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_domain&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;yourdomain&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_authentication&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;login&amp;quot;&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_enable_starttls_auto&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
+gitlab_ci&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;smtp_tls&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;false&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;smtp_enable&amp;#39;] = true&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;smtp_address&amp;#39;] = &amp;quot;smtp.server&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# gitlab_ci[&amp;#39;smtp_port&amp;#39;] = 456&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据/etc/gitlab/gitlab.rb重新配置gitlab。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo gitlab-ctl reconfigure
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用默认用户名:&lt;code&gt;root&lt;/code&gt; 密码:&lt;code&gt;5iveL!fe&lt;/code&gt;登陆，登陆后修改默认密码。&lt;/p&gt;
&lt;h2&gt;备份&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo crontab -l
&lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create
&lt;/pre&gt;&lt;/div&gt;</summary><category term="gitlab"></category></entry></feed>