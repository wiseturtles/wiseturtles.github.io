<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Wise Turtles</title><link href="http://blog.wiseturtles.com/" rel="alternate"></link><link href="http://blog.wiseturtles.com/feeds/elasticsearch.atom.xml" rel="self"></link><id>http://blog.wiseturtles.com/</id><updated>2015-06-19T00:00:00+08:00</updated><entry><title>Upgrade Elasticsearch 1.2.1 to 1.4.5</title><link href="http://blog.wiseturtles.com/posts/-Upgrade-Elasticsearch-1.2.1-to-1.4.5.html" rel="alternate"></link><updated>2015-06-19T00:00:00+08:00</updated><author><name>Zhang Wanming</name></author><id>tag:blog.wiseturtles.com,2015-06-19:posts/-Upgrade-Elasticsearch-1.2.1-to-1.4.5.html</id><summary type="html">&lt;p&gt;一年前刚开始做应用市场数据统计，团队选用了&lt;span class="caps"&gt;ELK&lt;/span&gt;中的&lt;span class="caps"&gt;EL&lt;/span&gt; (Elasticsearch, Logstash)，没有用Kibana；而且根据产品、运营需求调用&lt;span class="caps"&gt;ES&lt;/span&gt; Restful &lt;span class="caps"&gt;API&lt;/span&gt;，自己做Web展示。
用了以下插件:analysis-icu, analysis-ik, analysis-mmseg, analysis-pinyin
当时&lt;span class="caps"&gt;ES&lt;/span&gt;版本为1.2.1，一直没有升级，最近升级到1.4.5。&lt;/p&gt;
&lt;p&gt;我们之前服务器是Debian 7，现在服务器是CentOS 6.5；服务器版本和&lt;span class="caps"&gt;ES&lt;/span&gt;没有关系，至少我没碰到任何系统问题。&lt;/p&gt;
&lt;p&gt;目前有两台&lt;span class="caps"&gt;ES&lt;/span&gt; 1.2.1，准备用三台&lt;span class="caps"&gt;ES&lt;/span&gt;&amp;nbsp;1.4.5替换。刚开始没有root权限，只好下载压缩包安装。&lt;/p&gt;
&lt;p&gt;注: Elasticsearch和Logstash都需要安装&lt;span class="caps"&gt;JDK&lt;/span&gt;, 我们用的&lt;span class="caps"&gt;JDK&lt;/span&gt;&amp;nbsp;1.7&lt;/p&gt;
&lt;h1&gt;安装Logstash&amp;nbsp;1.4.3&lt;/h1&gt;
&lt;h2&gt;安装需要的软件包&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
&lt;span class="nv"&gt;$ &lt;/span&gt;wget https://download.elastic.co/logstash/logstash/logstash-1.4.3.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;tar zxf logstash-1.4.3.tar.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改配置文件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cat /data/softwares/logstash-1.4.3/logstash.conf &lt;span class="p"&gt;|&lt;/span&gt; grep -Ev &lt;span class="s1"&gt;&amp;#39;^#|^$&amp;#39;&lt;/span&gt;
input &lt;span class="o"&gt;{&lt;/span&gt;
  redis &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;codec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;appstore:logstash&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;passwd&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;appstore_logs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 0
  &lt;span class="o"&gt;}&lt;/span&gt;
  redis &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;codec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;passwd&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;appstore:overview_reports&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;overview_reports&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 0
  &lt;span class="o"&gt;}&lt;/span&gt;
  redis &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;codec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;passwd&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s1"&gt;&amp;#39;appstore:imei_reports&amp;#39;&lt;/span&gt;
    &lt;span class="nv"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;imei_reports&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 1
  &lt;span class="o"&gt;}&lt;/span&gt;
  redis &lt;span class="o"&gt;{&lt;/span&gt; 
     &lt;span class="nv"&gt;codec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;tclonline&amp;quot;&lt;/span&gt;
     &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;appstore:overview_date_reports&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;overview_date_reports&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; 
     &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 3
   &lt;span class="o"&gt;}&lt;/span&gt; 
   redis &lt;span class="o"&gt;{&lt;/span&gt; 
     &lt;span class="nv"&gt;codec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;pwd&amp;quot;&lt;/span&gt;
     &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;appstore:overview_model_reports&amp;quot;&lt;/span&gt; 
     &lt;span class="nv"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;overview_model_reports&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; 
     &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 3

   &lt;span class="o"&gt;}&lt;/span&gt; 
&lt;span class="o"&gt;}&lt;/span&gt;
filter &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;appstore_logs&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    date &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="nv"&gt;match&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;timestamp&amp;quot;&lt;/span&gt; , &lt;span class="s2"&gt;&amp;quot;UNIX&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;imei_reports&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    date &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="nv"&gt;match&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;timestamp&amp;quot;&lt;/span&gt; , &lt;span class="s2"&gt;&amp;quot;UNIX&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
output &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;appstore_logs&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    elasticsearch &lt;span class="o"&gt;{&lt;/span&gt; 
      &lt;span class="nv"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; logstash
      &lt;span class="nv"&gt;index_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;appstore_stats&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;cluster&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;elasticsearch_dashboard&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;node_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash_appstore_logs&amp;quot;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
    redis&lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="nv"&gt;data_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; 3
      &lt;span class="nv"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;x.x.x.x&amp;quot;&lt;/span&gt; 
      &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;passwd&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash:appstore_logs&amp;quot;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;overview_reports&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    elasticsearch &lt;span class="o"&gt;{&lt;/span&gt; 
      &lt;span class="nv"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; dashboard
      &lt;span class="nv"&gt;index_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;overview_records&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;cluster&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;elasticsearch_dashboard&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;node_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash_overview_reports&amp;quot;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
   &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;imei_reports&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    elasticsearch &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="nv"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; imei
      &lt;span class="nv"&gt;index_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;imei_records&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;cluster&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;elasticsearch_dashboard&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;node_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash_imei_reports&amp;quot;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
   &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;overview_date_reports&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; 
     elasticsearch &lt;span class="o"&gt;{&lt;/span&gt; 
       &lt;span class="nv"&gt;cluster&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;elasticsearch_dashboard&amp;quot;&lt;/span&gt; 
       &lt;span class="nv"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; dashboard 
       &lt;span class="nv"&gt;index_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;overview_date_records&amp;quot;&lt;/span&gt; 
       &lt;span class="nv"&gt;node_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash_overview_date_reports&amp;quot;&lt;/span&gt;
     &lt;span class="o"&gt;}&lt;/span&gt; 
   &lt;span class="o"&gt;}&lt;/span&gt; 
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;overview_model_reports&amp;quot;&lt;/span&gt; in &lt;span class="o"&gt;[&lt;/span&gt;tags&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; 
     elasticsearch &lt;span class="o"&gt;{&lt;/span&gt; 
       &lt;span class="nv"&gt;cluster&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;elasticsearch_dashboard&amp;quot;&lt;/span&gt; 
       &lt;span class="nv"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; dashboard 
       &lt;span class="nv"&gt;index_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;overview_model_records&amp;quot;&lt;/span&gt; 
       &lt;span class="nv"&gt;node_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;logstash_overview_model_reports&amp;quot;&lt;/span&gt;
     &lt;span class="o"&gt;}&lt;/span&gt; 
   &lt;span class="o"&gt;}&lt;/span&gt;   
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;启动测试&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/softwares/logstash-1.4.3
&lt;span class="nv"&gt;$ &lt;/span&gt;bin/logstash -f logstash.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;安装Elasticsearch&amp;nbsp;1.4.5&lt;/h1&gt;
&lt;h2&gt;安装需要的软件包&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
&lt;span class="nv"&gt;$ &lt;/span&gt;wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.4.5.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;tar zxf elasticsearch-1.4.5.tar.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;安装插件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software &lt;span class="c"&gt;# 安装分词插件&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;git clone -b 1.4.0 https://github.com/medcl/elasticsearch-rtf.git
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;elasticsearch-rtf
&lt;span class="nv"&gt;$ &lt;/span&gt;cp -vrf plugins/analysis-ik /data/softwares/elasticsearch-1.4.5/plugins/
&lt;span class="nv"&gt;$ &lt;/span&gt;cp -vrf config/ik config/mmseg /data/softwares/elasticsearch-1.4.5/config/


:::bash

&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software &lt;span class="c"&gt;# 监控插件&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;elasticsearch-1.4.5
&lt;span class="nv"&gt;$ &lt;/span&gt;bin/plugin -install mobz/elasticsearch-head &lt;span class="c"&gt;# head插件&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;bin/plugin -install lukas-vlcek/bigdesk     &lt;span class="c"&gt;# bigdesk插件&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改配置文件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cat /data/softwares/elasticsearch-1.4.5/config/elasticsearch.yml &lt;span class="p"&gt;|&lt;/span&gt; grep -Ev &lt;span class="s1"&gt;&amp;#39;^#|^$&amp;#39;&lt;/span&gt;
cluster.name: elasticsearch_dashboard
node.name: &lt;span class="s2"&gt;&amp;quot;es1&amp;quot;&lt;/span&gt;
node.master: &lt;span class="nb"&gt;true&lt;/span&gt;
node.data: &lt;span class="nb"&gt;true&lt;/span&gt;
index.number_of_shards: 5
index.number_of_replicas: 2
path.data: /data/softwares/elasticsearch-1.4.5/data
path.work: /data/softwares/elasticsearch-1.4.5/work
path.logs: /data/log/elasticsearch
path.plugins: /data/softwares/elasticsearch-1.4.5/plugins
network.bind_host: 192.168.1.2
network.publish_host: 192.168.1.2
network.host: 192.168.1.2
transport.tcp.port: 9300
http.port: 9200
indices.recovery.max_bytes_per_sec: 200mb
indices.recovery.concurrent_streams: 8
discovery.zen.minimum_master_nodes: 2
discovery.zen.ping.timeout: 10s
discovery.zen.ping.multicast.enabled: &lt;span class="nb"&gt;true&lt;/span&gt;
discovery.zen.ping.unicast.hosts: &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;192.168.1.2&amp;quot;&lt;/span&gt;, &lt;span class="s2"&gt;&amp;quot;192.168.1.6&amp;quot;&lt;/span&gt;, &lt;span class="s2"&gt;&amp;quot;192.168.1.7&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
index:
  analysis:
    analyzer:
      standardPlusWordDelimiter:
        &lt;span class="nb"&gt;type&lt;/span&gt;: custom
        tokenizer: standard
        filter: &lt;span class="o"&gt;[&lt;/span&gt;standard, wordDelim, lowercase, stop, dict&lt;span class="o"&gt;]&lt;/span&gt;
      ik:
        &lt;span class="nb"&gt;alias&lt;/span&gt;: &lt;span class="o"&gt;[&lt;/span&gt;ik_analyzer&lt;span class="o"&gt;]&lt;/span&gt;
        &lt;span class="nb"&gt;type&lt;/span&gt;: ik
      ik_max_word:
        &lt;span class="nb"&gt;type&lt;/span&gt;: ik
        use_smart: &lt;span class="nb"&gt;false&lt;/span&gt;
&lt;span class="nb"&gt;      &lt;/span&gt;ik_smart:
        &lt;span class="nb"&gt;type&lt;/span&gt;: ik
        use_smart: &lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nb"&gt;      &lt;/span&gt;pinyin_ngram_analyzer:
        &lt;span class="nb"&gt;type&lt;/span&gt;: custom
        tokenizer: my_pinyin
        filter: &lt;span class="o"&gt;[&lt;/span&gt;standard,lowercase,nGram,trim,unique&lt;span class="o"&gt;]&lt;/span&gt;     
    tokenizer:
      my_pinyin:
        &lt;span class="nb"&gt;type&lt;/span&gt;: pinyin
        first_letter: prefix
        padding_char : &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
    filter:
      wordDelim:
        &lt;span class="nb"&gt;type&lt;/span&gt;: word_delimiter
        preserve_original: &lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nb"&gt;      &lt;/span&gt;dict:
        &lt;span class="nb"&gt;type&lt;/span&gt;: dictionary_decompounder
        word_list: &lt;span class="o"&gt;[&lt;/span&gt;cool, iris, fire, bug, flag, fox, grease, monkey, flash, block, forecast, screen, grab, cookie, auto, fill, text, all, so, think, mega, upload, download, video, map, spring, fix, input, clip, fly, lang, up, down, persona, css, html, all, http, ball, firefox, bookmark, chat, zilla, edit, menu, menus, status, bar, with, easy, sync, search, google, &lt;span class="nb"&gt;time&lt;/span&gt;, window, js, super, scroll, title, close, undo, user, inspect, inspector, browser, context, dictionary, mail, button, url, password, secure, image, new, tab, delete, click, name, smart, down, manager, open, query, net, link, blog, this, color, &lt;span class="k"&gt;select&lt;/span&gt;, key, keys, foxy, translate, word&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注：
1. 删除了注释
2. 其它机器配置文件类似，只需要修改和&lt;span class="caps"&gt;IP&lt;/span&gt;相关的字段值&lt;/p&gt;
&lt;h2&gt;启动Elasticsearch&lt;/h2&gt;
&lt;p&gt;测试能否正常启动：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software/elasticsearch-1.4.5
&lt;span class="nv"&gt;$ &lt;/span&gt;bin/elasticsearch  &lt;span class="c"&gt;# 启动ES，测试是否可以正常启动&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;tail -f /data/log/elasticsearch/elasticsearch_dashboard.log &lt;span class="c"&gt;# 查看日志&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;监控插件使用&lt;/h2&gt;
&lt;p&gt;head: http://&lt;your-es-ip&gt;:9200/_plugin/head/
bigdesk: http://&lt;your-es-ip&gt;:9200/_plugin/bigdesk/&lt;/p&gt;
&lt;h1&gt;配置supervisor&lt;/h1&gt;
&lt;p&gt;如果可以正常启动，我们通过supervisor管理Elasticsearch和Logstash。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo pip install supervisor &lt;span class="c"&gt;# 后来拿到root权限，否则还要先弄Python virtual env&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;修改/etc/init.d/supervisor 以及 chkconfig 添加系统启动就不说了


:::bash

&lt;span class="nv"&gt;$ &lt;/span&gt;cat /etc/supervisor/supervisord.conf &lt;span class="p"&gt;|&lt;/span&gt; grep -Ev &lt;span class="s1"&gt;&amp;#39;^;|^$&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;unix_http_server&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/run/supervisor.sock    &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;the path to the socket file&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;chmod&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0700&lt;/span&gt;                       &lt;span class="p"&gt;;&lt;/span&gt; sockef file mode &lt;span class="o"&gt;(&lt;/span&gt;default 0700&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;rpcinterface:supervisor&lt;span class="o"&gt;]&lt;/span&gt;
supervisor.rpcinterface_factory &lt;span class="o"&gt;=&lt;/span&gt; supervisor.rpcinterface:make_main_rpcinterface
&lt;span class="o"&gt;[&lt;/span&gt;supervisord&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;http_port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/run/supervisor.sock &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;default is to run a UNIX domain socket server&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/supervisord.log &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;main log file&lt;span class="p"&gt;;&lt;/span&gt;default &lt;span class="nv"&gt;$CWD&lt;/span&gt;/supervisord.log&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;logfile_maxbytes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;50MB       &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;max main logfile bytes b4 rotation&lt;span class="p"&gt;;&lt;/span&gt;default 50MB&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;logfile_backups&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;          &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;num of main logfile rotation backups&lt;span class="p"&gt;;&lt;/span&gt;default 10&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;loglevel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;debug              &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;logging level&lt;span class="p"&gt;;&lt;/span&gt;default info&lt;span class="p"&gt;;&lt;/span&gt; others: debug,warn&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;pidfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/run/supervisord.pid &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;supervisord pidfile&lt;span class="p"&gt;;&lt;/span&gt;default supervisord.pid&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;nodaemon&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;              &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;start in foreground &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;default &lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;minfds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1024&lt;/span&gt;                 &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;min. avail startup file descriptors&lt;span class="p"&gt;;&lt;/span&gt;default 1024&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;minprocs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;200&lt;/span&gt;                &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;min. avail process descriptors&lt;span class="p"&gt;;&lt;/span&gt;default 200&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;childlogdir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;AUTO&amp;#39;&lt;/span&gt; child log dir, default &lt;span class="nv"&gt;$TEMP&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;supervisorctl&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;serverurl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;unix:////var/run/supervisor.sock &lt;span class="p"&gt;;&lt;/span&gt; use a unix:// URL  &lt;span class="k"&gt;for&lt;/span&gt; a unix socket
&lt;span class="o"&gt;[&lt;/span&gt;include&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nv"&gt;files&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /etc/supervisor/conf.d/*.conf


:::bash

&lt;span class="nv"&gt;$ &lt;/span&gt;cat /etc/supervisor/conf.d/elasticsearch.conf 
&lt;span class="o"&gt;[&lt;/span&gt;program:elasticsearch&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/softwares/elasticsearch-1.4.5/bin/elasticsearch -Xmx6g -Xms6g -XX:PermSize&lt;span class="o"&gt;=&lt;/span&gt;512m -Des.max-open-files&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;directory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/softwares/elasticsearch-1.4.5
&lt;span class="nv"&gt;user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;work
&lt;span class="nv"&gt;autostart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;autorestart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;stdout_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/elasticsearch.stdout
&lt;span class="nv"&gt;stderr_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/elasticsearch.stderr


:::bash

&lt;span class="nv"&gt;$ &lt;/span&gt;cat /etc/supervisor/conf.d/logstash.conf 
&lt;span class="o"&gt;[&lt;/span&gt;program:logstash&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/softwares/logstash-1.4.3/bin/logstash -f logstash.conf
&lt;span class="nv"&gt;directory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/softwares/logstash-1.4.3
&lt;span class="nv"&gt;user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;work
&lt;span class="nv"&gt;autostart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;autorestart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;stdout_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/logstash.stdout
&lt;span class="nv"&gt;stderr_logfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/data/log/supervisor/logstash.stderr
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;常用的&lt;span class="caps"&gt;ES&lt;/span&gt;命令别名&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;tail -n3 ~/.bashrc 
&lt;span class="nb"&gt;alias &lt;/span&gt;&lt;span class="nv"&gt;esh&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;curl &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ip -4 -o addr show dev eth0 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{split($4,a,&amp;quot;/&amp;quot;);print a[1]}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:9200/_cluster/health?pretty&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;alias &lt;/span&gt;&lt;span class="nv"&gt;esi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;curl &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ip -4 -o addr show dev eth0 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{split($4,a,&amp;quot;/&amp;quot;);print a[1]}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:9200/_cat/indices?pretty&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;alias &lt;/span&gt;&lt;span class="nv"&gt;ess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;curl &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ip -4 -o addr show dev eth0 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{split($4,a,&amp;quot;/&amp;quot;);print a[1]}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:9200/_cat/shards&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;alias &lt;/span&gt;&lt;span class="nv"&gt;esdownlocal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;curl &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ip -4 -o addr show dev eth0 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{split($4,a,&amp;quot;/&amp;quot;);print a[1]}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:9200/_cluster/nodes/_local/_shutdown&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;alias &lt;/span&gt;&lt;span class="nv"&gt;esdownall&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;curl &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ip -4 -o addr show dev eth0 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{split($4,a,&amp;quot;/&amp;quot;);print a[1]}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;:9200/_shutdown&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;升级&lt;/h1&gt;
&lt;p&gt;通过上面步骤，配置好3台Elasticsearch 1.4.5，然后，将这三台&lt;span class="caps"&gt;ES&lt;/span&gt;机器加入以前的Elasticsearch 1.2.1的集群。
数据逐步同步到&lt;span class="caps"&gt;ES&lt;/span&gt; 1.4.5后，逐步将&lt;span class="caps"&gt;ES&lt;/span&gt;&amp;nbsp;1.2.1的机器停掉。&lt;/p&gt;
&lt;h1&gt;碰到的问题&lt;/h1&gt;
&lt;h2&gt;没有将shard同步到新加入的&lt;span class="caps"&gt;ES&lt;/span&gt;&amp;nbsp;1.4.5机器上&lt;/h2&gt;
&lt;p&gt;修改number_of_replicas，根据机器个数修改。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl -XPUT &lt;span class="s1"&gt;&amp;#39;&amp;lt;your-ip&amp;gt;:9200/&amp;lt;your-index&amp;gt;/_settings&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;     &amp;quot;index&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;         &amp;quot;number_of_replicas&amp;quot; : 2&lt;/span&gt;
&lt;span class="s1"&gt;      }&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;明确让某个index的某个shard分配到指定机器上。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl -XPOST &lt;span class="s1"&gt;&amp;#39;&amp;lt;your-es-ip&amp;gt;:9200/_cluster/reroute&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;commands&amp;quot; : [ {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;move&amp;quot; :&lt;/span&gt;
&lt;span class="s1"&gt;            {&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;index&amp;quot; : &amp;quot;your-index&amp;quot;, &amp;quot;shard&amp;quot; : shard-no,&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;from_node&amp;quot; : &amp;quot;es-node-name&amp;quot;, &amp;quot;to_node&amp;quot; : &amp;quot;es-node-name&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        },&lt;/span&gt;
&lt;span class="s1"&gt;        {&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;quot;allocate&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;index&amp;quot; : &amp;quot;your-index&amp;quot;, &amp;quot;shard&amp;quot; : shard-no, &amp;quot;node&amp;quot; : &amp;quot;es-node-name&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;          }&lt;/span&gt;
&lt;span class="s1"&gt;        }&lt;/span&gt;
&lt;span class="s1"&gt;    ]&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;比如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;curl -XPOST &lt;span class="s1"&gt;&amp;#39;localhost:9200/_cluster/reroute&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;commands&amp;quot; : [ {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;move&amp;quot; :&lt;/span&gt;
&lt;span class="s1"&gt;            {&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;index&amp;quot; : &amp;quot;logstash_v1_new&amp;quot;, &amp;quot;shard&amp;quot; : 4,&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;from_node&amp;quot; : &amp;quot;Yojimbo&amp;quot;, &amp;quot;to_node&amp;quot; : &amp;quot;es3&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        },&lt;/span&gt;
&lt;span class="s1"&gt;        {&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;quot;allocate&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;index&amp;quot; : &amp;quot;logstash_v1_new&amp;quot;, &amp;quot;shard&amp;quot; : 4, &amp;quot;node&amp;quot; : &amp;quot;es2&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;          }&lt;/span&gt;
&lt;span class="s1"&gt;        }&lt;/span&gt;
&lt;span class="s1"&gt;    ]&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;参考：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;http://stackoverflow.com/questions/23656458/elasticsearch-what-to-do-with-unassigned-shards/&lt;/li&gt;
&lt;li&gt;http://stackoverflow.com/questions/25135869/how-to-rebalance-shard-elasticsearch&lt;/li&gt;
&lt;li&gt;https://t37.net/how-to-fix-your-elasticsearch-cluster-stuck-in-initializing-shards-mode.html&lt;/li&gt;
&lt;li&gt;http://stackoverflow.com/questions/19967472/elasticsearch-unassigned-shards-how-to-fix&lt;/li&gt;
&lt;/ol&gt;</summary><category term="Dashboard"></category><category term="Elasticsearch"></category><category term="Logstash"></category><category term="ELK"></category></entry></feed>