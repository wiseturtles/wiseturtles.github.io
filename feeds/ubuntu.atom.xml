<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Wise Turtles</title><link href="http://blog.wiseturtles.com/" rel="alternate"></link><link href="http://blog.wiseturtles.com/feeds/ubuntu.atom.xml" rel="self"></link><id>http://blog.wiseturtles.com/</id><updated>2015-07-06T15:00:00+08:00</updated><entry><title>sSMTP发送邮件</title><link href="http://blog.wiseturtles.com/posts/install-sSMTP.html" rel="alternate"></link><updated>2015-07-06T15:00:00+08:00</updated><author><name>ox0spy</name></author><id>tag:blog.wiseturtles.com,2015-07-06:posts/install-sSMTP.html</id><summary type="html">&lt;p&gt;工作中很多场景需要发送邮件，如：报警邮件、日报等。本文介绍如何安装、配置sSMTP做邮件发送。&lt;/p&gt;
&lt;h2&gt;安装&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install ssmtp
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;配置&lt;/h2&gt;
&lt;p&gt;/etc/ssmtp/revaliases&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/ssmtp/revaliases
&lt;span class="c1"&gt;# sSMTP aliases&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Format:   local_account:outgoing_address:mailhub&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Example: root:your_login@your.domain:mailhub.your.domain[:port]&lt;/span&gt;
&lt;span class="c1"&gt;# where [:port] is an optional port number that defaults to 25.&lt;/span&gt;
nagios:no-reply@example.com:mail.example.com:587
root:no-reply@example.com:mail.example.com:587
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/ssmtp/ssmtp.conf&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Config file for sSMTP sendmail&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# The person who gets all mail for userids &amp;lt; 1000&lt;/span&gt;
&lt;span class="c1"&gt;# Make this empty to disable rewriting.&lt;/span&gt;
&lt;span class="nv"&gt;root&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;your-email@example.com&amp;gt;
&lt;span class="c1"&gt;# The place where the mail goes. The actual machine name is required no&lt;/span&gt;
&lt;span class="c1"&gt;# MX records are consulted. Commonly mailhosts are named mail.domain.com&lt;/span&gt;
&lt;span class="nv"&gt;mailhub&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;mail.example.com&amp;gt;
&lt;span class="c1"&gt;# Where will the mail seem to come from?&lt;/span&gt;
&lt;span class="c1"&gt;#rewriteDomain=&lt;/span&gt;
&lt;span class="c1"&gt;# The full hostname&lt;/span&gt;
&lt;span class="nv"&gt;hostname&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;mail.example.com&amp;gt;
&lt;span class="c1"&gt;# Are users allowed to set their own From: address?&lt;/span&gt;
&lt;span class="c1"&gt;# YES - Allow the user to specify their own From: address&lt;/span&gt;
&lt;span class="c1"&gt;# NO - Use the system generated From: address&lt;/span&gt;
&lt;span class="nv"&gt;FromLineOverride&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;YES
&lt;span class="nv"&gt;UseSTARTTLS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes
&lt;span class="nv"&gt;UseTLS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes
&lt;span class="nv"&gt;AuthUser&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;your-domain/username&amp;gt;
&lt;span class="nv"&gt;AuthPass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;your-passwd&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;测试&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ /usr/sbin/sendmail -t -F your-domain-name &lt;span class="s"&gt;&amp;lt;&amp;lt;EOF&lt;/span&gt;
&lt;span class="s"&gt;SUBJECT: $YOUR-SUBJECT&lt;/span&gt;
&lt;span class="s"&gt;TO: A@example.com,B@example.com&lt;/span&gt;
&lt;span class="s"&gt;MIME-VERSION: 1.0&lt;/span&gt;
&lt;span class="s"&gt;Content-type: text/plain&lt;/span&gt;
&lt;span class="s"&gt;$YOUR-MAIL-BODY&lt;/span&gt;

&lt;span class="s"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Debian"></category><category term="sSMTP"></category></entry><entry><title>Install Nagios 4 on Ubuntu/Debian</title><link href="http://blog.wiseturtles.com/posts/install-nagios4-on-ubuntu-or-debian.html" rel="alternate"></link><updated>2015-05-23T00:00:00+08:00</updated><author><name>Zhang Wanming</name></author><id>tag:blog.wiseturtles.com,2015-05-23:posts/install-nagios4-on-ubuntu-or-debian.html</id><summary type="html">&lt;p&gt;Ucloud后台监控系统功能很简单，最近发现之前设置过的监控项也无法正常显示，更不能编辑了。&amp;nbsp;虽然，马上就要将系统迁移到公司自己大家的云平台，但，最近Ucloud服务器压力很大，周末抽空先将Nagios搭建起来，让自己能及时收到报警。&lt;/p&gt;
&lt;p&gt;我们Ucloud服务器都用的Debian 7 (wheezy)，源里只有nagios3，所以，自己编译、安装Nagios&amp;nbsp;4。&lt;/p&gt;
&lt;h1&gt;监控主机安装Nagios&lt;/h1&gt;
&lt;h2&gt;安装需要的软件包&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install build-essential libgd2-xpm-dev openssl libssl-dev apache2 php5 libapache2-mod-php5 apache2-utils postfix
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;创建用户、组&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo useradd nagios
$ sudo groupadd nagcmd
$ sudo usermod -a -G nagcmd nagios
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;安装nagios&amp;nbsp;4&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
$ wget http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-4.0.8.tar.gz
$ tar zxf nagios-4.0.8.tar.gz
$ &lt;span class="nb"&gt;cd&lt;/span&gt; nagios-4.0.8
$ ./configure --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-command-group&lt;span class="o"&gt;=&lt;/span&gt;nagcmd --with-mail&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;which sendmail&lt;span class="k"&gt;)&lt;/span&gt;
$ sudo make all
$ sudo make install &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-commandmode &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-init &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-config
$ sudo ln -s /etc/init.d/nagios /etc/rcS.d/S99nagios &lt;span class="c1"&gt;# 开机自启动&lt;/span&gt;
$ sudo service nagios restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置apache2&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo /usr/bin/install -c -m &lt;span class="m"&gt;644&lt;/span&gt; sample-config/httpd.conf /etc/apache2/sites-available/nagios.conf
$ sudo ln -s /etc/apache2/sites-available/nagios.conf /etc/apache2/sites-enabled/
$ sudo a2enmod rewrite
$ sudo a2enmod cgi
$ sudo htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin
$ sudo service apache2 restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;浏览器访问 http://监控主机&lt;span class="caps"&gt;IP&lt;/span&gt;/nagios 查看监控情况, 登录用户名、密码就是 htpasswd 设置的。
nagios 4将被安装到 /usr/local/nagios 目录，该目录下的 etc&amp;nbsp;是配置文件夹。&lt;/p&gt;
&lt;h2&gt;安装nagios-plugins-2.0.3&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
$ wget https://nagios-plugins.org/download/nagios-plugins-2.0.3.tar.gz
$ tar zxf nagios-plugins-2.0.3.tar.gz
$ &lt;span class="nb"&gt;cd&lt;/span&gt; nagios-plugins-2.0.3
$ ./configure --with-nagios-user&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-openssl
$ make all &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;nagios-plugins 命令安装在 /usr/local/nagios/libexec&amp;nbsp;目录。&lt;/p&gt;
&lt;h2&gt;安装nagios-nrpe-2.15&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
$ wget -O nrpe-2.15.tar.gz &lt;span class="s2"&gt;&amp;quot;http://downloads.sourceforge.net/project/nagios/nrpe-2.x/nrpe-2.15/nrpe-2.15.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fnagios%2Ffiles%2Fnrpe-2.x%2Fnrpe-2.15%2F&amp;amp;ts=1432369927&amp;amp;use_mirror=liquidtelecom&amp;quot;&lt;/span&gt;
$ tar zxf nrpe-2.15.tar.gz
$ &lt;span class="nb"&gt;cd&lt;/span&gt; nrpe-2.15
$ ./configure --with-nagios-user&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-ssl&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/openssl --with-ssl-lib&lt;span class="o"&gt;=&lt;/span&gt;/usr/lib/x86_64-linux-gnu 
$ make all
$ find -iname &lt;span class="s1"&gt;&amp;#39;check_nrpe&amp;#39;&lt;/span&gt;
$ sudo /usr/bin/install -c -m &lt;span class="m"&gt;755&lt;/span&gt; ./src/check_nrpe /usr/local/nagios/libexec/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;测试是否可以工作:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ /usr/local/nagios/libexec/check_nrpe -H 10.4.2.2 &lt;span class="c1"&gt;# 该IP是被监控主机的IP&lt;/span&gt;
NRPE v2.13
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;被监控主机安装Nagios &lt;span class="caps"&gt;NRPE&lt;/span&gt;&lt;/h1&gt;
&lt;p&gt;安装nagios-plugins,&amp;nbsp;nagios-nrpe-server&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install nagios-plugins nagios-nrpe-server
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置nagios-nrpe-server，允许监控主机连接该被监控主机。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo vim /etc/nagios/nrpe.cfg
$ 将 监控主机IP 填入 allowed_hosts 字段，如: &lt;span class="nv"&gt;allowed_hosts&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;127.0.0.1,10.4.22.22
$ sudo service nagios-nrpe-server restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;配置&lt;/h1&gt;
&lt;h2&gt;配置监控主机&lt;/h2&gt;
&lt;p&gt;/usr/local/nagios/etc/nagios.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ diff -u nagios.cfg.back nagios.cfg
--- nagios.cfg.back2015-05-23 11:07:51.436491931 +0800
+++ nagios.cfg2015-05-23 22:08:09.872618927 +0800
@@ -30,6 +30,9 @@
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/contacts.cfg
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/timeperiods.cfg
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/templates.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/hosts.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/groups.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/services.cfg

&lt;span class="c1"&gt;# Definitions for monitoring the local (Linux) host&lt;/span&gt;
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/localhost.cfg
@@ -1174,7 +1177,7 @@
&lt;span class="c1"&gt;# using the $ADMINEMAIL$ and $ADMINPAGER$ macros in your notification&lt;/span&gt;
&lt;span class="c1"&gt;# commands.&lt;/span&gt;

-admin_email&lt;span class="o"&gt;=&lt;/span&gt;nagios@localhost
+admin_email&lt;span class="o"&gt;=&lt;/span&gt;your-emai-address
&lt;span class="nv"&gt;admin_pager&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;pagenagios@localhost
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/usr/local/nagios/etc/objects/hosts.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="c1"&gt;# Define a host for the local machine&lt;/span&gt;
&lt;span class="c1"&gt;##############&lt;/span&gt;
&lt;span class="c1"&gt;# appstore01 #&lt;/span&gt;
&lt;span class="c1"&gt;##############&lt;/span&gt;
define host&lt;span class="o"&gt;{&lt;/span&gt;
    use                             linux-server  &lt;span class="p"&gt;;&lt;/span&gt; Name of host template to use
                                    &lt;span class="p"&gt;;&lt;/span&gt; This host definition will inherit all variables that are defined
                                    &lt;span class="p"&gt;;&lt;/span&gt; in &lt;span class="o"&gt;(&lt;/span&gt;or inherited by&lt;span class="o"&gt;)&lt;/span&gt; the linux-server host template definition.
    host_name                       appstore01
    &lt;span class="nb"&gt;alias&lt;/span&gt;                           appstore01 on ucloud
    address                         10.4.2.2
    &lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;##############&lt;/span&gt;
&lt;span class="c1"&gt;# appstore02 #&lt;/span&gt;
&lt;span class="c1"&gt;##############&lt;/span&gt;
define host&lt;span class="o"&gt;{&lt;/span&gt;
    use                             linux-server  &lt;span class="p"&gt;;&lt;/span&gt; Name of host template to use
                                    &lt;span class="p"&gt;;&lt;/span&gt; This host definition will inherit all variables that are defined
                                    &lt;span class="p"&gt;;&lt;/span&gt; in &lt;span class="o"&gt;(&lt;/span&gt;or inherited by&lt;span class="o"&gt;)&lt;/span&gt; the linux-server host template definition.
    host_name                       appstore02
    &lt;span class="nb"&gt;alias&lt;/span&gt;                           appstore02 on ucloud
    address                         10.4.2.22
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/usr/local/nagios/etc/objects/groups.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Define an optional hostgroup for Linux machines&lt;/span&gt;
define hostgroup&lt;span class="o"&gt;{&lt;/span&gt;
    hostgroup_name  appstore-group &lt;span class="p"&gt;;&lt;/span&gt; The name of the hostgroup
    &lt;span class="nb"&gt;alias&lt;/span&gt;           appstore server group &lt;span class="p"&gt;;&lt;/span&gt; Long name of the group
    members         appstore01,appstore02     &lt;span class="p"&gt;;&lt;/span&gt; Comma separated list of hosts that belong to this group
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/local/nagios/etc/objects/commands.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ diff -u objects/commands.cfg.back objects/commands.cfg
+########################
+# add by zhang wanming &lt;span class="c1"&gt;#&lt;/span&gt;
+########################
+# &lt;span class="s1"&gt;&amp;#39;check_mysql&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command&lt;/span&gt; definition
+define command&lt;span class="o"&gt;{&lt;/span&gt;
+   command_name    check_mysql
+   command_line    &lt;span class="nv"&gt;$USER1&lt;/span&gt;$/check_mysql -H &lt;span class="nv"&gt;$HOSTADDRESS&lt;/span&gt;$ -u &lt;span class="nv"&gt;$ARG1&lt;/span&gt;$ -p &lt;span class="nv"&gt;$ARG2&lt;/span&gt;$ -d &lt;span class="nv"&gt;$ARG3&lt;/span&gt;$ -P 3306
+   &lt;span class="o"&gt;}&lt;/span&gt;

+# &lt;span class="s1"&gt;&amp;#39;check_http_with_url_port&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command&lt;/span&gt; definition
+define command&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name    check_http_with_url_port
+        command_line    &lt;span class="nv"&gt;$USER1&lt;/span&gt;$/check_http -I &lt;span class="nv"&gt;$HOSTADDRESS&lt;/span&gt;$ -u &lt;span class="nv"&gt;$ARG1&lt;/span&gt;$ -p &lt;span class="nv"&gt;$ARG2&lt;/span&gt;$
+        &lt;span class="o"&gt;}&lt;/span&gt;
+
+# &lt;span class="s1"&gt;&amp;#39;check_nrpe&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command&lt;/span&gt; definition
+define command&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name check_nrpe
+        command_line &lt;span class="nv"&gt;$USER1&lt;/span&gt;$/check_nrpe -H &lt;span class="nv"&gt;$HOSTADDRESS&lt;/span&gt;$ -c &lt;span class="nv"&gt;$ARG1&lt;/span&gt;$
+        &lt;span class="o"&gt;}&lt;/span&gt;
+
+# &lt;span class="s1"&gt;&amp;#39;check_memcached&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command&lt;/span&gt; definition
+define command&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name check_memcached
+        command_line &lt;span class="nv"&gt;$USER1&lt;/span&gt;$/check_tcp -H &lt;span class="nv"&gt;$HOSTADDRESS&lt;/span&gt;$ -p &lt;span class="m"&gt;11211&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;stats\r\nquit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime&amp;#39;&lt;/span&gt; -M crit
+        &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/local/nagios/etc/objects/services.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat objects/services.cfg 
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             PING
        check_command                   check_ping!100.0,20%!500.0,60%
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             SSH
        check_command                   check_ssh!-p 1122
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#################&lt;/span&gt;
&lt;span class="c1"&gt;# HTTP services #&lt;/span&gt;
&lt;span class="c1"&gt;#################&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Nginx
        check_command                   check_http
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http tdnaceweb
        check_command                   check_nrpe!check_http_tdanceweb
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http appstore
        check_command                   check_nrpe!check_http_appstore
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http launcher
        check_command                   check_nrpe!check_http_launcher
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#########&lt;/span&gt;
&lt;span class="c1"&gt;# Redis #&lt;/span&gt;
&lt;span class="c1"&gt;#########&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Redis
        check_command                   check_nrpe!check_redis
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#############&lt;/span&gt;
&lt;span class="c1"&gt;# Memcached #&lt;/span&gt;
&lt;span class="c1"&gt;#############&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Memcached
        check_command                   check_nrpe!check_memcached
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#########&lt;/span&gt;
&lt;span class="c1"&gt;# MySQL #&lt;/span&gt;
&lt;span class="c1"&gt;#########&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        host_name                       appstore01
        service_description             MySQL
        check_command                   check_nrpe!check_mysql
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;################&lt;/span&gt;
&lt;span class="c1"&gt;# disk/partion #&lt;/span&gt;
&lt;span class="c1"&gt;################&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check root disk
        check_command                   check_nrpe!check_disk_root
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check root data
        check_command                   check_nrpe!check_disk_data
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;配置被监控主机&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/nagios/nrpe_local.cfg 
&lt;span class="c1"&gt;######################################&lt;/span&gt;
&lt;span class="c1"&gt;# Do any local nrpe configuration here&lt;/span&gt;
&lt;span class="c1"&gt;######################################&lt;/span&gt;
command&lt;span class="o"&gt;[&lt;/span&gt;check_disk_root&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_disk -w 25% -c 10% -p /
command&lt;span class="o"&gt;[&lt;/span&gt;check_disk_data&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_disk -w 25% -c 10% -p /data
command&lt;span class="o"&gt;[&lt;/span&gt;check_redis&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_tcp -H localhost -p &lt;span class="m"&gt;6379&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;info\r\n&amp;#39;&lt;/span&gt; -q &lt;span class="s1"&gt;&amp;#39;quit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime_in_days&amp;#39;&lt;/span&gt; -M crit
command&lt;span class="o"&gt;[&lt;/span&gt;check_memcached&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_tcp -H localhost -p &lt;span class="m"&gt;11211&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;stats\r\nquit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime&amp;#39;&lt;/span&gt; -M crit
command&lt;span class="o"&gt;[&lt;/span&gt;check_mysql&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_mysql -H localhost -u user -p passwd -d your-database
command&lt;span class="o"&gt;[&lt;/span&gt;check_http_tdanceweb&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;6688&lt;/span&gt; -t 3
command&lt;span class="o"&gt;[&lt;/span&gt;check_http_appstore&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;8888&lt;/span&gt; -t &lt;span class="m"&gt;3&lt;/span&gt; -u /m3/subjects
command&lt;span class="o"&gt;[&lt;/span&gt;check_http_launcher&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;9999&lt;/span&gt; -t 3
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;配置过程中碰到的问题&lt;/h1&gt;
&lt;h2&gt;监控服务器上没有check_nrpe命令&lt;/h2&gt;
&lt;p&gt;如果没有安装nrpe，请下载、编译、安装，请参考&amp;nbsp;安装nagios-nrpe-2.15&lt;/p&gt;
&lt;h2&gt;CHECK_NRPE: Error - Could not complete &lt;span class="caps"&gt;SSL&lt;/span&gt;&amp;nbsp;handshake.&lt;/h2&gt;
&lt;p&gt;编辑/etc/nagios/nrpe.cfg, 确定 allowed_hosts 中加入监控主机&lt;span class="caps"&gt;IP&lt;/span&gt;，多个&lt;span class="caps"&gt;IP&lt;/span&gt;以 &amp;#8220;,&amp;#8221; 分隔。
如:&amp;nbsp;allowed_hosts=127.0.0.1,10.4.13.14&lt;/p&gt;
&lt;p&gt;然后，重新加载 nagios-nrpe-server&amp;nbsp;配置文件，如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ service nagios-nrpe-server reload
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;下次再学习并补充联系人及报警相关设置。&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-install-nagios-4-and-monitor-your-servers-on-ubuntu-14-04"&gt;https://www.digitalocean.com/community/tutorials/how-to-install-nagios-4-and-monitor-your-servers-on-ubuntu-14-04&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://netkiller.github.io/monitoring/nagios/"&gt;http://netkiller.github.io/monitoring/nagios/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</summary><category term="Ubuntu"></category><category term="Debian"></category><category term="Monitor"></category><category term="Management"></category></entry><entry><title>linux 小贴士</title><link href="http://blog.wiseturtles.com/posts/linux-tips.html" rel="alternate"></link><updated>2015-01-20T18:16:00+08:00</updated><author><name>crazygit</name></author><id>tag:blog.wiseturtles.com,2015-01-20:posts/linux-tips.html</id><summary type="html">&lt;h2&gt;ssh端口转发&lt;/h2&gt;
&lt;p&gt;由于服务器上一些服务的端口没有对外开发，但是在开发时又想直接使用服务器上的这些服务，该怎么办？&lt;/p&gt;
&lt;p&gt;以我们服务器A(192.167.0.1) 为例, 上面有Elasticsheach数据库为例, 由于Elasticsearch数据库比较&amp;nbsp;大，从服务器上将数据拷贝到本地不太现实，便可以通过ssh端口转发来实现。&lt;/p&gt;
&lt;p&gt;前提:&amp;nbsp;本地服务器可以通过ssh登陆到服务器A(192.167.0.1)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ssh -fNL 9200:localhost:9200 192.167.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;通过上面命令可以在本地机器和服务器A的9200端口之间做一个隧道，访问本地的9200端&amp;nbsp;口就跟直接访问服务器A上的9200端口一样。&lt;/p&gt;
&lt;p&gt;为了使用方便，可以为上面的命令设置一个别名,添加到&lt;code&gt;~/.bashrc&lt;/code&gt;中，&amp;nbsp;如&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;alias&lt;/span&gt; &lt;span class="nv"&gt;sshes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ssh -fNL 9200:localhost:9200 192.167.0.1&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;那么以后使用&lt;code&gt;sshes&lt;/code&gt;就可以方便的建立一个ssh隧道连接,　同理，此法可用于连接服务器上的mysql及其它服务.&lt;/p&gt;
&lt;p&gt;另外一个常用的是通过ssh翻墙的命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ssh -qTfnN -D &lt;span class="m"&gt;7070&lt;/span&gt; 192.167.0.2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;前提是172.167.0.2是一台可以直接翻墙的机器(如国外的云主机),执行上面的命令后便可以通过本地的7070端口翻墙.&lt;/p&gt;
&lt;p&gt;更多关于ssh转发的可以查看下面的文章:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://codelife.me/blog/2012/12/09/three-types-of-ssh-turneling/"&gt;三种不同类型的ssh隧道&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ssh登陆配置&lt;/h2&gt;
&lt;p&gt;登陆到远程服务器时,当服务器上的用户名和本地的用户名不一致且端口也不是默认端口时.
以服务器A(192.168.0.1), 用户名为root, 端口为4455。我们每次登陆到远程主机或拷贝
文件时,&amp;nbsp;都需要带上用户名和端口信息。如:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# ssh登陆&lt;/span&gt;
$ ssh -p &lt;span class="m"&gt;4455&lt;/span&gt; root@192.168.0.1
&lt;span class="c1"&gt;# scp拷贝&lt;/span&gt;
$ scp -P &lt;span class="m"&gt;4455&lt;/span&gt; root@192.168.0.1:/tmp/a a
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样比较繁琐。稍微配置一下便可以化繁为简&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat ~/.ssh/config
Host 192.168.0.1
    User root
    Port 4455
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样以后每次访问该服务器都不需要带上用户及端口信息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# ssh登陆&lt;/span&gt;
$ ssh 192.168.0.1
&lt;span class="c1"&gt;# scp拷贝&lt;/span&gt;
$ scp -P 192.168.0.1:/tmp/a a
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当本机需要通过不同的key登陆到不同的服务器时，我们都是通过&lt;code&gt;-i&lt;/code&gt;来临时指定key.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 使用a.key登陆192.168.0.1&lt;/span&gt;
$ ssh -i ~/.ssh/a.key 192.168.0.1
&lt;span class="c1"&gt;# 使用b.key登陆192.168.0.2&lt;/span&gt;
$ ssh -i ~/.ssh/b.key 192.168.0.2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;稍微配置一下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat ~/.ssh/config
Host 192.168.0.1
    User root
    Port 4455
    IdentityFile ~/.ssh/a.key

Host 192.168.0.2
    User root
    Port 4455
    IdentityFile ~/.ssh/b.key
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置之后每次登陆不同的服务器也不需要通过&lt;code&gt;-i&lt;/code&gt;参数指定key了。&lt;/p&gt;
&lt;h2&gt;~/.bashrc配置&lt;/h2&gt;
&lt;p&gt;下面介绍的都是可以添加到&lt;code&gt;~/.bashrc&lt;/code&gt;中的一些配置.&lt;/p&gt;
&lt;h3&gt;让man&amp;nbsp;page不再单调&lt;/h3&gt;
&lt;p&gt;平时使用man page的时候，都是黑白的文字。看起来很是不方便，稍微配置一下，可以让
你的man&amp;nbsp;page充满颜色。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# color man pages&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_mb&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[01;31m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_md&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[01;31m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_me&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[0m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_se&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[0m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_so&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[01;44;33m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_ue&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[0m&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LESS_TERMCAP_us&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;$&amp;#39;\E[01;32m&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;source ~/.bashrc&lt;/code&gt;后，man一个命令可以看到效果&lt;/p&gt;
&lt;h3&gt;终端操作使用vim模式&lt;/h3&gt;
&lt;p&gt;从&lt;code&gt;@WanMing&lt;/code&gt;处习得的技能，vim控必备&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt; -o vi
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;效果如何，谁用谁知道&lt;/p&gt;
&lt;h3&gt;python自动激活项目的虚拟环境&lt;/h3&gt;
&lt;p&gt;重写&lt;code&gt;cd&lt;/code&gt;命令，使它在进入到python项目时，自动激活与项目名一样的虚拟环境&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;function&lt;/span&gt; workon_cwd &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;# Check that this is a Git repo&lt;/span&gt;
    &lt;span class="nv"&gt;GIT_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;git rev-parse --git-dir 2&amp;gt; /dev/null&lt;span class="sb"&gt;`&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="c1"&gt;# Find the repo root and check for virtualenv name override&lt;/span&gt;
        &lt;span class="nv"&gt;GIT_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="se"&gt;\c&lt;/span&gt;d &lt;span class="nv"&gt;$GIT_DIR&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;pwd&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
        &lt;span class="nv"&gt;PROJECT_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;dirname &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GIT_DIR&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
        &lt;span class="nv"&gt;ENV_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;basename &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROJECT_ROOT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROJECT_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/.venv&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;ENV_NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;cat &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROJECT_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/.venv&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="c1"&gt;# Activate the environment only if it is not already active&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$VIRTUAL_ENV&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$WORKON_HOME&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$ENV_NAME&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$WORKON_HOME&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$ENV_NAME&lt;/span&gt;&lt;span class="s2"&gt;/bin/activate&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
                workon &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$ENV_NAME&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CD_VIRTUAL_ENV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$ENV_NAME&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
            &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$CD_VIRTUAL_ENV&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="c1"&gt;# We&amp;#39;ve just left the repo, deactivate the environment&lt;/span&gt;
        &lt;span class="c1"&gt;# Note: this only happens if the virtualenv was activated automatically&lt;/span&gt;
        deactivate &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;unset&lt;/span&gt; CD_VIRTUAL_ENV
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# New cd function that does the virtualenv magic&lt;/span&gt;
&lt;span class="k"&gt;function&lt;/span&gt; venv_cd &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$@&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; workon_cwd
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;alias&lt;/span&gt; &lt;span class="nv"&gt;cd&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;venv_cd&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# init for create new terminal tab&lt;/span&gt;
workon_cwd
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;个性化终端提示符&lt;/h3&gt;
&lt;p&gt;通过设置&lt;span class="caps"&gt;PS1&lt;/span&gt;变量, 可以个性化终端提示符,&amp;nbsp;展示更多有用信息.&lt;/p&gt;
&lt;p&gt;如我的终端设置, 里面包含了项目的分支，当前&lt;span class="caps"&gt;HEAD&lt;/span&gt;值，及git库的状态信息&lt;/p&gt;
&lt;p&gt;&lt;img alt="PS1 screenshot" src="http://pic.yupoo.com/crazygit_v/En4dALxz/medium.jpg" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;PS1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;TITLEBAR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;
&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;SAVE_CURSOR&lt;/span&gt;&lt;span class="si"&gt;}${&lt;/span&gt;&lt;span class="nv"&gt;MOVE_CURSOR_RIGHTMOST&lt;/span&gt;&lt;span class="si"&gt;}${&lt;/span&gt;&lt;span class="nv"&gt;MOVE_CURSOR_5_LEFT&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;RESTORE_CURSOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;VIRTUALENV&lt;/span&gt;&lt;span class="p"&gt;:+(&lt;/span&gt;&lt;span class="nv"&gt;$VIRTUALENV&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="si"&gt;}${&lt;/span&gt;&lt;span class="nv"&gt;D_USER_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\u &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;D_INTERMEDIATE_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;at &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;D_MACHINE_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\h &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;D_INTERMEDIATE_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;in &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;D_DIR_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\w &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;D_INTERMEDIATE_COLOR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="k"&gt;$(&lt;/span&gt;demula_vcprompt&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;\&lt;/span&gt;
&lt;span class="k"&gt;$(&lt;/span&gt;is_vim_shell&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如下是一个在线生成&lt;span class="caps"&gt;PS1&lt;/span&gt;变量的网站，可以根据自己的需求定制&lt;span class="caps"&gt;PS1&lt;/span&gt;变量:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bashrcgenerator.com/"&gt;http://bashrcgenerator.com/&lt;/a&gt;&lt;/p&gt;</summary><category term="linux"></category><category term="tips"></category></entry><entry><title>WIFI Hotspot Setup On Ubuntu 12.04</title><link href="http://blog.wiseturtles.com/posts/wifi-hotspot-setup-on-ubuntu.html" rel="alternate"></link><updated>2014-12-30T00:00:00+08:00</updated><author><name>Zhang Wanming</name></author><id>tag:blog.wiseturtles.com,2014-12-30:posts/wifi-hotspot-setup-on-ubuntu.html</id><summary type="html">&lt;p&gt;hotspot配置参考：http://thenewbieblog.wordpress.com/2012/05/01/wifi-hotspot-setup-on-ubuntu/
Android利用Fiddler抓包：http://www.trinea.cn/android/android-network-sniffer/&amp;nbsp;Android利用tcpdump抓包：http://www.trinea.cn/android/tcpdump_wireshark/&lt;/p&gt;
&lt;p&gt;为了Ubuntu笔记本方便对Android手机上的Apps做抓包, 本文介绍两种方法，方法二更容易配置。
有线、无线同时可以工作时，用下面方法将无线网卡作为hotspot，通过有线连接外网。
如果想直接通过无线网卡上外网，需要先停掉hostapd 或&amp;nbsp;ap-hotspot，并重启网络。&lt;/p&gt;
&lt;p&gt;重启网络:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo service network-manager restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;方法一&lt;/h1&gt;
&lt;h2&gt;查看无线网卡硬件信息&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo lspci &lt;span class="p"&gt;|&lt;/span&gt; grep -i network
03:00.0 Network controller: Intel Corporation Wireless &lt;span class="m"&gt;7260&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;rev 6b&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;查看无线网卡驱动信息&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ lsmod
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;查看无线网卡设备名称&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ iwconfig
wlan0     IEEE 802.11bgn  Mode:Master  Tx-Power&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt; dBm   
          Retry  long limit:7   RTS thr:off   Fragment thr:off
          Power Management:on
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;安装需要的软件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install dhcp3-server hostapd
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/hostapd/hostapd.conf&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/hostapd/hostapd.conf
&lt;span class="nv"&gt;interface&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;wlan0
&lt;span class="nv"&gt;driver&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;nl80211
&lt;span class="nv"&gt;ssid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;your_hotspot_name
&lt;span class="nv"&gt;channel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1
&lt;span class="nv"&gt;hw_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;g
&lt;span class="nv"&gt;auth_algs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1
&lt;span class="nv"&gt;wpa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;3
&lt;span class="nv"&gt;wpa_passphrase&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;your-password
&lt;span class="nv"&gt;wpa_key_mgmt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;WPA-PSK
&lt;span class="nv"&gt;wpa_pairwise&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;TKIP CCMP
&lt;span class="nv"&gt;rsn_pairwise&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;CCMP
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/default/isc-dhcp-server&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ grep INTERFACES /etc/default/isc-dhcp-server
&lt;span class="nv"&gt;INTERFACES&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wlan0&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/dhcp/dhcpd.conf&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;配置文件: /etc/dhcp/dhcpd.conf
Make sure the follow lines are Commented out &lt;span class="o"&gt;(&lt;/span&gt; put a &lt;span class="nb"&gt;hash&lt;/span&gt; “#”  sign at the beginning of the line &lt;span class="o"&gt;)&lt;/span&gt; the following lines:
&lt;span class="c1"&gt;# option definitions common to all supported networks…&lt;/span&gt;
&lt;span class="c1"&gt;#option domain-name “example.org”;&lt;/span&gt;
&lt;span class="c1"&gt;#option domain-name-servers ns1.example.org, ns2.example.org;&lt;/span&gt;
&lt;span class="c1"&gt;#default-lease-time 600;&lt;/span&gt;
&lt;span class="c1"&gt;#max-lease-time 7200;&lt;/span&gt;

Add the following lines to the file &lt;span class="o"&gt;(&lt;/span&gt;copy and paste&lt;span class="o"&gt;)&lt;/span&gt;
subnet 10.10.0.0 netmask 255.255.255.0 &lt;span class="o"&gt;{&lt;/span&gt;
        range 10.10.0.2 10.10.0.16&lt;span class="p"&gt;;&lt;/span&gt;
        option domain-name-servers 8.8.4.4, 208.67.222.222&lt;span class="p"&gt;;&lt;/span&gt;
        option routers 10.10.0.1&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="o"&gt;(&lt;/span&gt;Note: the only other line in this whole config file that is uncommented is :

ddns-update-style none&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/default/hostapd&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ grep -E &lt;span class="s1"&gt;&amp;#39;RUN_DAEMON|DAEMON_CONF|DAEMON_OPTS&amp;#39;&lt;/span&gt; /etc/default/hostapd &lt;span class="p"&gt;|&lt;/span&gt; grep -Ev &lt;span class="s1"&gt;&amp;#39;^#&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;RUN_DAEMON&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;DAEMON_CONF&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/etc/hostapd/hostapd.conf&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;DAEMON_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-dd&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/network/interfaces&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/network/interfaces
auto lo
iface lo inet loopback
auto wlan0
iface wlan0 inet static
    address 10.10.0.1
    netmask 255.255.255.0
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/sysctl.conf&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ grep net.ipv4.ip_forward /etc/sysctl.conf 
net.ipv4.ip_forward&lt;span class="o"&gt;=&lt;/span&gt;1
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;修改/etc/rc.local&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;编辑 /etc/rc.local, 在 &lt;span class="s2"&gt;&amp;quot;exit 0&amp;quot;&lt;/span&gt; 前添加下一行
iptables -t nat -A POSTROUTING -s 10.10.0.0/16 -o ppp0 -j MASQUERADE
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;重启电脑&lt;/h2&gt;
&lt;p&gt;重启电脑，手机测试是否可以连接.&lt;/p&gt;
&lt;h1&gt;方法二&lt;/h1&gt;
&lt;p&gt;用ap-hotspot更容易搭建。&lt;/p&gt;
&lt;h2&gt;ap-hotspot安装、配置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo add-apt-repository ppa:nilarimogard/webupd8
$ sudo apt-get install ap-hotspot
$ sudo ap-hotspot configure &lt;span class="c1"&gt;# configure&lt;/span&gt;
$ sudo ap-hotspot start &lt;span class="c1"&gt;# start&lt;/span&gt;
$ sudo ap-hotspot stop &lt;span class="c1"&gt;# stop&lt;/span&gt;
$ sudo ap-hotspot restart &lt;span class="c1"&gt;# restart&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Ubuntu"></category></entry><entry><title>Upgrade Ubuntu from 10.04 to 12.04</title><link href="http://blog.wiseturtles.com/posts/upgrade-ubuntu-from-10.04-to-12.04.html" rel="alternate"></link><updated>2014-12-04T00:00:00+08:00</updated><author><name>Zhang Wanming</name></author><id>tag:blog.wiseturtles.com,2014-12-04:posts/upgrade-ubuntu-from-10.04-to-12.04.html</id><summary type="html">&lt;p&gt;公司开发人员电脑都安装的是Ubuntu 10.04，现在越来越不好用，而且，很多同事发现编译最新的Firefox &lt;span class="caps"&gt;OS&lt;/span&gt;都有问题，所以，我尝试升级并把碰到的问题记录下来。&lt;/p&gt;
&lt;h1&gt;升级&lt;/h1&gt;
&lt;h2&gt;修改源&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/apt/sources.list
deb http://172.26.32.18/ubuntu/ lucid main restricted universe multiverse
deb http://172.26.32.18/ubuntu/ lucid-security main restricted universe multiverse
deb http://172.26.32.18/ubuntu/ lucid-updates main restricted universe multiverse
deb http://172.26.32.18/ubuntu/ lucid-proposed main restricted universe multiverse
deb http://172.26.32.18/ubuntu/ lucid-backports main restricted universe multiverse

&lt;span class="c1"&gt;# aliyun&lt;/span&gt;
deb http://mirrors.aliyun.com/ubuntu/ lucid main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ lucid-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ lucid-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ lucid-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ lucid-backports main restricted universe multiverse
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;开始升级&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo &lt;span class="k"&gt;do&lt;/span&gt;-release-upgrade
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;nis无法启动，导致升级过程中配置nis包失败&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ grep redhat /etc/hosts
172.26.32.12    cd-redhat-001.TCTCD

$ tail -1 /etc/yp.conf 
ypserver cd-redhat-001.TCTCD

$ cat /etc/defaultdomain 
TCTCD

$ grep NIS /etc/default/nis &lt;span class="p"&gt;|&lt;/span&gt; grep -Ev &lt;span class="s1"&gt;&amp;#39;#&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;NISSERVER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;
&lt;span class="nv"&gt;NISCLIENT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;span class="nv"&gt;NISMASTER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;

$ cat /etc/auto.master
/home /etc/auto.home

$ cat /etc/auto.home 
xcsu cd-redhat-001.TCTCD:/home/xcsu

$ /usr/lib/yp/ypinit -s cd-redhat-001.TCTCD

$ sudo service portmap restart
$ sudo service nis restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;启动后登录时发现只能用administrator和guest登录&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cat /etc/lightdm/lightdm.conf 
&lt;span class="o"&gt;[&lt;/span&gt;SeatDefaults&lt;span class="o"&gt;]&lt;/span&gt;
user-session&lt;span class="o"&gt;=&lt;/span&gt;ubuntu
greeter-session&lt;span class="o"&gt;=&lt;/span&gt;unity-greeter
allow-guest&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;
greeter-show-manual-login&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;重启电脑，就可以用其它用户登录了&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo reboot
&lt;/pre&gt;&lt;/div&gt;</summary><category term="Ubuntu"></category><category term="Nis"></category></entry></feed>