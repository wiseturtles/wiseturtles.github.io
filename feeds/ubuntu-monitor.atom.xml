<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Wise Turtles</title><link href="http://blog.wiseturtles.com/" rel="alternate"></link><link href="http://blog.wiseturtles.com/feeds/ubuntu-monitor.atom.xml" rel="self"></link><id>http://blog.wiseturtles.com/</id><updated>2015-05-23T00:00:00+08:00</updated><entry><title>Install Nagios 4 on Ubuntu/Debian</title><link href="http://blog.wiseturtles.com/posts/install-nagios4-on-ubuntu/debian.html" rel="alternate"></link><updated>2015-05-23T00:00:00+08:00</updated><author><name>Zhang Wanming</name></author><id>tag:blog.wiseturtles.com,2015-05-23:posts/install-nagios4-on-ubuntu/debian.html</id><summary type="html">&lt;p&gt;Ucloud后台监控系统功能很简单，最近发现之前设置过的监控项也无法正常显示，更不能编辑了。&amp;nbsp;虽然，马上就要将系统迁移到公司自己大家的云平台，但，最近Ucloud服务器压力很大，周末抽空先将Nagios搭建起来，让自己能及时收到报警。&lt;/p&gt;
&lt;p&gt;我们Ucloud服务器都用的Debian 7 (wheezy)，源里只有nagios3，所以，自己编译、安装Nagios&amp;nbsp;4。&lt;/p&gt;
&lt;h1&gt;监控主机安装Nagios&lt;/h1&gt;
&lt;h2&gt;安装需要的软件包&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo apt-get install build-essential libgd2-xpm-dev openssl libssl-dev apache2 php5 libapache2-mod-php5 apache2-utils postfix
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;创建用户、组&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo useradd nagios
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo groupadd nagcmd
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo usermod -a -G nagcmd nagios
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;安装nagios&amp;nbsp;4&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
&lt;span class="nv"&gt;$ &lt;/span&gt;wget http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-4.0.8.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;tar zxf nagios-4.0.8.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;nagios-4.0.8
&lt;span class="nv"&gt;$ &lt;/span&gt;./configure --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-command-group&lt;span class="o"&gt;=&lt;/span&gt;nagcmd --with-mail&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;which sendmail&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo make all
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo make install &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-commandmode &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-init &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install-config
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo ln -s /etc/init.d/nagios /etc/rcS.d/S99nagios &lt;span class="c"&gt;# 开机自启动&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo service nagios restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置apache2&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo /usr/bin/install -c -m &lt;span class="m"&gt;644&lt;/span&gt; sample-config/httpd.conf /etc/apache2/sites-available/nagios.conf
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo ln -s /etc/apache2/sites-available/nagios.conf /etc/apache2/sites-enabled/
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo a2enmod rewrite
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo a2enmod cgi
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo service apache2 restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;nagios 4将被安装到 /usr/local/nagios 目录，该目录下的 etc&amp;nbsp;是配置文件夹。&lt;/p&gt;
&lt;h2&gt;安装nagios-plugins-2.0.3&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
&lt;span class="nv"&gt;$ &lt;/span&gt;wget https://nagios-plugins.org/download/nagios-plugins-2.0.3.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;tar zxf nagios-plugins-2.0.3.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;nagios-plugins-2.0.3
&lt;span class="nv"&gt;$ &lt;/span&gt;./configure --with-nagios-user&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-openssl
&lt;span class="nv"&gt;$ &lt;/span&gt;make all &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;nagios-plugins 命令安装在 /usr/local/nagios/libexec&amp;nbsp;目录。&lt;/p&gt;
&lt;h2&gt;安装nagios-nrpe-2.15&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /data/software
&lt;span class="nv"&gt;$ &lt;/span&gt;wget -O nrpe-2.15.tar.gz &lt;span class="s2"&gt;&amp;quot;http://downloads.sourceforge.net/project/nagios/nrpe-2.x/nrpe-2.15/nrpe-2.15.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fnagios%2Ffiles%2Fnrpe-2.x%2Fnrpe-2.15%2F&amp;amp;ts=1432369927&amp;amp;use_mirror=liquidtelecom&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;tar zxf nrpe-2.15.tar.gz
&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd &lt;/span&gt;nrpe-2.15
&lt;span class="nv"&gt;$ &lt;/span&gt;./configure --with-nagios-user&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-nagios-group&lt;span class="o"&gt;=&lt;/span&gt;nagios --with-ssl&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/openssl --with-ssl-lib&lt;span class="o"&gt;=&lt;/span&gt;/usr/lib/x86_64-linux-gnu 
&lt;span class="nv"&gt;$ &lt;/span&gt;make all
&lt;span class="nv"&gt;$ &lt;/span&gt;find -iname &lt;span class="s1"&gt;&amp;#39;check_nrpe&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo /usr/bin/install -c -m &lt;span class="m"&gt;755&lt;/span&gt; ./src/check_nrpe /usr/local/nagios/libexec/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;测试是否可以工作:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;/usr/local/nagios/libexec/check_nrpe -H 10.4.2.2 &lt;span class="c"&gt;# 该IP是被监控主机的IP&lt;/span&gt;
NRPE v2.13
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;被监控主机安装Nagios &lt;span class="caps"&gt;NRPE&lt;/span&gt;&lt;/h1&gt;
&lt;p&gt;安装nagios-plugins,&amp;nbsp;nagios-nrpe-server&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo apt-get install nagios-plugins nagios-nrpe-server
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置nagios-nrpe-server，允许监控主机连接该被监控主机。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo vim /etc/nagios/nrpe.cfg
&lt;span class="nv"&gt;$ &lt;/span&gt;将 监控主机IP 填入 allowed_hosts 字段，如: &lt;span class="nv"&gt;allowed_hosts&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;127.0.0.1,10.4.22.22
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo service nagios-nrpe-server restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;配置&lt;/h1&gt;
&lt;h2&gt;配置监控主机&lt;/h2&gt;
&lt;p&gt;/usr/local/nagios/etc/nagios.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;diff -u nagios.cfg.back nagios.cfg
--- nagios.cfg.back2015-05-23 11:07:51.436491931 +0800
+++ nagios.cfg2015-05-23 22:08:09.872618927 +0800
@@ -30,6 +30,9 @@
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/contacts.cfg
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/timeperiods.cfg
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/templates.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/hosts.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/groups.cfg
+cfg_file&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/services.cfg

&lt;span class="c"&gt;# Definitions for monitoring the local (Linux) host&lt;/span&gt;
&lt;span class="nv"&gt;cfg_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nagios/etc/objects/localhost.cfg
@@ -1174,7 +1177,7 @@
&lt;span class="c"&gt;# using the $ADMINEMAIL$ and $ADMINPAGER$ macros in your notification&lt;/span&gt;
&lt;span class="c"&gt;# commands.&lt;/span&gt;

-admin_email&lt;span class="o"&gt;=&lt;/span&gt;nagios@localhost
+admin_email&lt;span class="o"&gt;=&lt;/span&gt;your-emai-address
&lt;span class="nv"&gt;admin_pager&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;pagenagios@localhost
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/usr/local/nagios/etc/objects/hosts.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;&lt;span class="c"&gt;# Define a host for the local machine&lt;/span&gt;
&lt;span class="c"&gt;##############&lt;/span&gt;
&lt;span class="c"&gt;# appstore01 #&lt;/span&gt;
&lt;span class="c"&gt;##############&lt;/span&gt;
define host&lt;span class="o"&gt;{&lt;/span&gt;
    use                             linux-server  &lt;span class="p"&gt;;&lt;/span&gt; Name of host template to use
                                    &lt;span class="p"&gt;;&lt;/span&gt; This host definition will inherit all variables that are defined
                                    &lt;span class="p"&gt;;&lt;/span&gt; in &lt;span class="o"&gt;(&lt;/span&gt;or inherited by&lt;span class="o"&gt;)&lt;/span&gt; the linux-server host template definition.
    host_name                       appstore01
    &lt;span class="nb"&gt;alias                           &lt;/span&gt;appstore01 on ucloud
    address                         10.4.2.2
    &lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;##############&lt;/span&gt;
&lt;span class="c"&gt;# appstore02 #&lt;/span&gt;
&lt;span class="c"&gt;##############&lt;/span&gt;
define host&lt;span class="o"&gt;{&lt;/span&gt;
    use                             linux-server  &lt;span class="p"&gt;;&lt;/span&gt; Name of host template to use
                                    &lt;span class="p"&gt;;&lt;/span&gt; This host definition will inherit all variables that are defined
                                    &lt;span class="p"&gt;;&lt;/span&gt; in &lt;span class="o"&gt;(&lt;/span&gt;or inherited by&lt;span class="o"&gt;)&lt;/span&gt; the linux-server host template definition.
    host_name                       appstore02
    &lt;span class="nb"&gt;alias                           &lt;/span&gt;appstore02 on ucloud
    address                         10.4.2.22
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/usr/local/nagios/etc/objects/groups.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Define an optional hostgroup for Linux machines&lt;/span&gt;
define hostgroup&lt;span class="o"&gt;{&lt;/span&gt;
    hostgroup_name  appstore-group &lt;span class="p"&gt;;&lt;/span&gt; The name of the hostgroup
    &lt;span class="nb"&gt;alias           &lt;/span&gt;appstore server group &lt;span class="p"&gt;;&lt;/span&gt; Long name of the group
    members         appstore01,appstore02     &lt;span class="p"&gt;;&lt;/span&gt; Comma separated list of hosts that belong to this group
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/local/nagios/etc/objects/commands.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;diff -u objects/commands.cfg.back objects/commands.cfg
+########################
+# add by zhang wanming &lt;span class="c"&gt;#&lt;/span&gt;
+########################
+# &lt;span class="s1"&gt;&amp;#39;check_mysql&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command &lt;/span&gt;definition
+define &lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
+   command_name    check_mysql
+   command_line    &lt;span class="nv"&gt;$USER1$/&lt;/span&gt;check_mysql -H &lt;span class="nv"&gt;$HOSTADDRESS$ &lt;/span&gt;-u &lt;span class="nv"&gt;$ARG1$ &lt;/span&gt;-p &lt;span class="nv"&gt;$ARG2$ &lt;/span&gt;-d &lt;span class="nv"&gt;$ARG3$ &lt;/span&gt;-P 3306
+   &lt;span class="o"&gt;}&lt;/span&gt;

+# &lt;span class="s1"&gt;&amp;#39;check_http_with_url_port&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command &lt;/span&gt;definition
+define &lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name    check_http_with_url_port
+        command_line    &lt;span class="nv"&gt;$USER1$/&lt;/span&gt;check_http -I &lt;span class="nv"&gt;$HOSTADDRESS$ &lt;/span&gt;-u &lt;span class="nv"&gt;$ARG1$ &lt;/span&gt;-p &lt;span class="nv"&gt;$ARG2&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;
+        &lt;span class="o"&gt;}&lt;/span&gt;
+
+# &lt;span class="s1"&gt;&amp;#39;check_nrpe&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command &lt;/span&gt;definition
+define &lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name check_nrpe
+        command_line &lt;span class="nv"&gt;$USER1$/&lt;/span&gt;check_nrpe -H &lt;span class="nv"&gt;$HOSTADDRESS$ &lt;/span&gt;-c &lt;span class="nv"&gt;$ARG1&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;
+        &lt;span class="o"&gt;}&lt;/span&gt;
+
+# &lt;span class="s1"&gt;&amp;#39;check_memcached&amp;#39;&lt;/span&gt; &lt;span class="nb"&gt;command &lt;/span&gt;definition
+define &lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
+        command_name check_memcached
+        command_line &lt;span class="nv"&gt;$USER1$/&lt;/span&gt;check_tcp -H &lt;span class="nv"&gt;$HOSTADDRESS$ &lt;/span&gt;-p &lt;span class="m"&gt;11211&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;stats\r\nquit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime&amp;#39;&lt;/span&gt; -M crit
+        &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/etc/local/nagios/etc/objects/services.cfg&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cat objects/services.cfg 
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             PING
        check_command                   check_ping!100.0,20%!500.0,60%
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             SSH
        check_command                   check_ssh!-p 1122
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;#################&lt;/span&gt;
&lt;span class="c"&gt;# HTTP services #&lt;/span&gt;
&lt;span class="c"&gt;#################&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Nginx
        check_command                   check_http
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http tdnaceweb
        check_command                   check_nrpe!check_http_tdanceweb
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http appstore
        check_command                   check_nrpe!check_http_appstore
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check http launcher
        check_command                   check_nrpe!check_http_launcher
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;#########&lt;/span&gt;
&lt;span class="c"&gt;# Redis #&lt;/span&gt;
&lt;span class="c"&gt;#########&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Redis
        check_command                   check_nrpe!check_redis
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;#############&lt;/span&gt;
&lt;span class="c"&gt;# Memcached #&lt;/span&gt;
&lt;span class="c"&gt;#############&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             Memcached
        check_command                   check_nrpe!check_memcached
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;#########&lt;/span&gt;
&lt;span class="c"&gt;# MySQL #&lt;/span&gt;
&lt;span class="c"&gt;#########&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        host_name                       appstore01
        service_description             MySQL
        check_command                   check_nrpe!check_mysql
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;################&lt;/span&gt;
&lt;span class="c"&gt;# disk/partion #&lt;/span&gt;
&lt;span class="c"&gt;################&lt;/span&gt;
define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check root disk
        check_command                   check_nrpe!check_disk_root
&lt;span class="o"&gt;}&lt;/span&gt;

define service &lt;span class="o"&gt;{&lt;/span&gt;
        use                             generic-service
        hostgroup_name                  appstore-group
        service_description             check root data
        check_command                   check_nrpe!check_disk_data
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;配置被监控主机&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;cat /etc/nagios/nrpe_local.cfg 
&lt;span class="c"&gt;######################################&lt;/span&gt;
&lt;span class="c"&gt;# Do any local nrpe configuration here&lt;/span&gt;
&lt;span class="c"&gt;######################################&lt;/span&gt;
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_disk_root&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_disk -w 25% -c 10% -p /
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_disk_data&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_disk -w 25% -c 10% -p /data
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_redis&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_tcp -H localhost -p &lt;span class="m"&gt;6379&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;info\r\n&amp;#39;&lt;/span&gt; -q &lt;span class="s1"&gt;&amp;#39;quit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime_in_days&amp;#39;&lt;/span&gt; -M crit
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_memcached&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_tcp -H localhost -p &lt;span class="m"&gt;11211&lt;/span&gt; -t &lt;span class="m"&gt;5&lt;/span&gt; -E -s &lt;span class="s1"&gt;&amp;#39;stats\r\nquit\r\n&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;uptime&amp;#39;&lt;/span&gt; -M crit
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_mysql&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_mysql -H localhost -u user -p passwd -d your-database
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_http_tdanceweb&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;6688&lt;/span&gt; -t 3
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_http_appstore&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;8888&lt;/span&gt; -t &lt;span class="m"&gt;3&lt;/span&gt; -u /m3/subjects
&lt;span class="nb"&gt;command&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;check_http_launcher&lt;span class="o"&gt;]=&lt;/span&gt;/usr/lib/nagios/plugins/check_http -H localhost -p &lt;span class="m"&gt;9999&lt;/span&gt; -t 3
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;配置过程中碰到的问题&lt;/h1&gt;
&lt;h2&gt;监控服务器上没有check_nrpe命令&lt;/h2&gt;
&lt;p&gt;如果没有安装nrpe，请下载、编译、安装，请参考&amp;nbsp;安装nagios-nrpe-2.15&lt;/p&gt;
&lt;h2&gt;CHECK_NRPE: Error - Could not complete &lt;span class="caps"&gt;SSL&lt;/span&gt;&amp;nbsp;handshake.&lt;/h2&gt;
&lt;p&gt;编辑/etc/nagios/nrpe.cfg, 确定 allowed_hosts 中加入监控主机&lt;span class="caps"&gt;IP&lt;/span&gt;，多个&lt;span class="caps"&gt;IP&lt;/span&gt;以 &amp;#8220;,&amp;#8221; 分隔。
如:&amp;nbsp;allowed_hosts=127.0.0.1,10.4.13.14&lt;/p&gt;
&lt;p&gt;然后，重新加载 nagios-nrpe-server&amp;nbsp;配置文件，如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;service nagios-nrpe-server reload
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;下次再学习并补充联系人及报警相关设置。&lt;/p&gt;</summary><category term="Ubuntu"></category><category term="Debian"></category><category term="Monitor"></category><category term="Management"></category></entry></feed>